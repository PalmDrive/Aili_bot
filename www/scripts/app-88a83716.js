"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function(){angular.module("AiliBot",["ionic","restangular","monospaced.elastic","dibari.angular-ellipsis","yw.alert","ngWebSocket"]).run(["Auth",function(e){e.isLogin()&&e.setHttpHeaders()}]).config(["$locationProvider","$stateProvider","$urlRouterProvider","appRouter","ENV",function(e,t,n,i,a){e.html5Mode({enabled:"development"!==a,requireBase:!1,rewriteLinks:!1}),n.rule(function(e,t){var n,i=t.path(),a="/"===i[i.length-1],s=t.search();return a?(n=i.substr(0,i.length-1),s&&!_.isEmpty(s)&&(n+="?"+_.map(s,function(e,t){return t+"="+e}).join("&")),n):void 0}),i(t),n.otherwise("/")}])}(),function(){var e={host:"http://ailibot-service.xiaobandengapp.com",path:"/api",V2path:"/api/v2",port:""},t={bucket:"xiaobandeng-production"},n={appId:"1jvJOjcK9lLg66oYNWaNO6S5-gzGzoHsz",appKey:"uM2u25jiNH6Le3CKTB9asrNI"};e.url=e.port?e.host+":"+e.port+e.path:e.host+e.path,e.getURL=function(t){t=t||"v2";var n="v1"===t?e.path:e.V2path;return e.port?e.host+":"+e.port+n:e.host+n},angular.module("AiliBot").constant("API_ENDPOINT",e).constant("FIREBASE_APP","smartchat-production").constant("OSS_CONFIG",t).constant("X_SMARTCHAT_KEY","6f1ba4f85ee571b004ccfcf21329d6e197807cf556").constant("ENV","production").constant("LEAN_CLOUD",n)}(),function(){var e=angular.module("yw.alert",[]);e.service("ywAlert",["$compile","$rootScope","$timeout",function(e,t,n){this._cachedAlertElements={},this.create=function(i,a){var s,r={alert:{id:"yw-alert-"+ +new Date,type:"success"},options:{last:3e3,container:"body"}},o=t.$new();i=_.extend(r.alert,i),a=_.extend(r.options,a||{}),o.alert=i,s=$('<yw-alert alert="alert"></yw-alert>').attr(i),$(a.container).append(s),n(function(){s=$(e(s)(o)[0]),this._cachedAlertElements[i.id]=s}.bind(this),0),n(function(){this.close(i.id)}.bind(this),a.last)},this.close=function(e){this._cachedAlertElements[e].remove(),delete this._cachedAlertElements[e]}}]),e.directive("ywAlert",["ywAlert",function(e){return{restrict:"EA",replace:!0,scope:{alert:"="},template:'<div class="yw-alert yw-alert-{{alert.type}}">                  <div class="yw-alert-header"></div>                  <div class="yw-alert-message">{{alert.message}}</div>                  <button type="button" class="yw-alert-close" ng-click="close()">x</button>                </div>',link:function(t,n,i){t.close=function(){e.close(i.id)}}}}])}(),function(){var e,t,n,i,a,s,r,o,l=[].slice,c={}.hasOwnProperty,d=function(e,t){function n(){this.constructor=e}for(var i in t)c.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};r=function(){},t=function(){function e(){}return e.prototype.addEventListener=e.prototype.on,e.prototype.on=function(e,t){return this._callbacks=this._callbacks||{},this._callbacks[e]||(this._callbacks[e]=[]),this._callbacks[e].push(t),this},e.prototype.emit=function(){var e,t,n,i,a,s;if(i=arguments[0],e=2<=arguments.length?l.call(arguments,1):[],this._callbacks=this._callbacks||{},n=this._callbacks[i])for(a=0,s=n.length;s>a;a++)t=n[a],t.apply(this,e);return this},e.prototype.removeListener=e.prototype.off,e.prototype.removeAllListeners=e.prototype.off,e.prototype.removeEventListener=e.prototype.off,e.prototype.off=function(e,t){var n,i,a,s,r;if(!this._callbacks||0===arguments.length)return this._callbacks={},this;if(i=this._callbacks[e],!i)return this;if(1===arguments.length)return delete this._callbacks[e],this;for(a=s=0,r=i.length;r>s;a=++s)if(n=i[a],n===t){i.splice(a,1);break}return this},e}(),e=function(e){function n(e,t){var a,s,r;if(this.element=e,this.version=n.version,this.defaultOptions.previewTemplate=this.defaultOptions.previewTemplate.replace(/\n*/g,""),this.clickableElements=[],this.listeners=[],this.files=[],"string"==typeof this.element&&(this.element=document.querySelector(this.element)),!this.element||null==this.element.nodeType)throw new Error("Invalid dropzone element.");if(this.element.dropzone)throw new Error("Dropzone already attached.");if(n.instances.push(this),this.element.dropzone=this,a=null!=(r=n.optionsForElement(this.element))?r:{},this.options=i({},this.defaultOptions,a,null!=t?t:{}),this.options.forceFallback||!n.isBrowserSupported())return this.options.fallback.call(this);if(null==this.options.url&&(this.options.url=this.element.getAttribute("action")),!this.options.url)throw new Error("No URL provided.");if(this.options.acceptedFiles&&this.options.acceptedMimeTypes)throw new Error("You can't provide both 'acceptedFiles' and 'acceptedMimeTypes'. 'acceptedMimeTypes' is deprecated.");this.options.acceptedMimeTypes&&(this.options.acceptedFiles=this.options.acceptedMimeTypes,delete this.options.acceptedMimeTypes),this.options.method=this.options.method.toUpperCase(),(s=this.getExistingFallback())&&s.parentNode&&s.parentNode.removeChild(s),this.options.previewsContainer!==!1&&(this.options.previewsContainer?this.previewsContainer=n.getElement(this.options.previewsContainer,"previewsContainer"):this.previewsContainer=this.element),this.options.clickable&&(this.options.clickable===!0?this.clickableElements=[this.element]:this.clickableElements=n.getElements(this.options.clickable,"clickable")),this.init()}var i,a;return d(n,e),n.prototype.Emitter=t,n.prototype.events=["drop","dragstart","dragend","dragenter","dragover","dragleave","addedfile","addedfiles","removedfile","thumbnail","error","errormultiple","processing","processingmultiple","uploadprogress","totaluploadprogress","sending","sendingmultiple","success","successmultiple","canceled","canceledmultiple","complete","completemultiple","reset","maxfilesexceeded","maxfilesreached","queuecomplete"],n.prototype.defaultOptions={url:null,method:"post",withCredentials:!1,parallelUploads:2,uploadMultiple:!1,maxFilesize:256,paramName:"file",createImageThumbnails:!0,maxThumbnailFilesize:10,thumbnailWidth:120,thumbnailHeight:120,filesizeBase:1e3,maxFiles:null,params:{},clickable:!0,ignoreHiddenFiles:!0,acceptedFiles:null,acceptedMimeTypes:null,autoProcessQueue:!0,autoQueue:!0,addRemoveLinks:!1,previewsContainer:null,hiddenInputContainer:"body",capture:null,dictDefaultMessage:"Drop files here to upload",dictFallbackMessage:"Your browser does not support drag'n'drop file uploads.",dictFallbackText:"Please use the fallback form below to upload your files like in the olden days.",dictFileTooBig:"File is too big ({{filesize}}MiB). Max filesize: {{maxFilesize}}MiB.",dictInvalidFileType:"You can't upload files of this type.",dictResponseError:"Server responded with {{statusCode}} code.",dictCancelUpload:"Cancel upload",dictCancelUploadConfirmation:"Are you sure you want to cancel this upload?",dictRemoveFile:"Remove file",dictRemoveFileConfirmation:null,dictMaxFilesExceeded:"You can not upload any more files.",accept:function(e,t){return t()},init:function(){return r},forceFallback:!1,fallback:function(){var e,t,i,a,s,r;for(this.element.className=""+this.element.className+" dz-browser-not-supported",r=this.element.getElementsByTagName("div"),a=0,s=r.length;s>a;a++)e=r[a],/(^| )dz-message($| )/.test(e.className)&&(t=e,e.className="dz-message");return t||(t=n.createElement('<div class="dz-message"><span></span></div>'),this.element.appendChild(t)),i=t.getElementsByTagName("span")[0],i&&(null!=i.textContent?i.textContent=this.options.dictFallbackMessage:null!=i.innerText&&(i.innerText=this.options.dictFallbackMessage)),this.element.appendChild(this.getFallbackForm())},resize:function(e){var t,n,i;return t={srcX:0,srcY:0,srcWidth:e.width,srcHeight:e.height},n=e.width/e.height,t.optWidth=this.options.thumbnailWidth,t.optHeight=this.options.thumbnailHeight,null==t.optWidth&&null==t.optHeight?(t.optWidth=t.srcWidth,t.optHeight=t.srcHeight):null==t.optWidth?t.optWidth=n*t.optHeight:null==t.optHeight&&(t.optHeight=1/n*t.optWidth),i=t.optWidth/t.optHeight,e.height<t.optHeight||e.width<t.optWidth?(t.trgHeight=t.srcHeight,t.trgWidth=t.srcWidth):n>i?(t.srcHeight=e.height,t.srcWidth=t.srcHeight*i):(t.srcWidth=e.width,t.srcHeight=t.srcWidth/i),t.srcX=(e.width-t.srcWidth)/2,t.srcY=(e.height-t.srcHeight)/2,t},drop:function(e){return this.element.classList.remove("dz-drag-hover")},dragstart:r,dragend:function(e){return this.element.classList.remove("dz-drag-hover")},dragenter:function(e){return this.element.classList.add("dz-drag-hover")},dragover:function(e){return this.element.classList.add("dz-drag-hover")},dragleave:function(e){return this.element.classList.remove("dz-drag-hover")},paste:r,reset:function(){return this.element.classList.remove("dz-started")},addedfile:function(e){var t,i,a,s,r,o,l,c,d,u,p,m,h;if(this.element===this.previewsContainer&&this.element.classList.add("dz-started"),this.previewsContainer){for(e.previewElement=n.createElement(this.options.previewTemplate.trim()),e.previewTemplate=e.previewElement,this.previewsContainer.appendChild(e.previewElement),u=e.previewElement.querySelectorAll("[data-dz-name]"),s=0,l=u.length;l>s;s++)t=u[s],t.textContent=e.name;for(p=e.previewElement.querySelectorAll("[data-dz-size]"),r=0,c=p.length;c>r;r++)t=p[r],t.innerHTML=this.filesize(e.size);for(this.options.addRemoveLinks&&(e._removeLink=n.createElement('<a class="dz-remove" href="javascript:undefined;" data-dz-remove>'+this.options.dictRemoveFile+"</a>"),e.previewElement.appendChild(e._removeLink)),i=function(t){return function(i){return i.preventDefault(),i.stopPropagation(),e.status===n.UPLOADING?n.confirm(t.options.dictCancelUploadConfirmation,function(){return t.removeFile(e)}):t.options.dictRemoveFileConfirmation?n.confirm(t.options.dictRemoveFileConfirmation,function(){return t.removeFile(e)}):t.removeFile(e)}}(this),m=e.previewElement.querySelectorAll("[data-dz-remove]"),h=[],o=0,d=m.length;d>o;o++)a=m[o],h.push(a.addEventListener("click",i));return h}},removedfile:function(e){var t;return e.previewElement&&null!=(t=e.previewElement)&&t.parentNode.removeChild(e.previewElement),this._updateMaxFilesReachedClass()},thumbnail:function(e,t){var n,i,a,s;if(e.previewElement){for(e.previewElement.classList.remove("dz-file-preview"),s=e.previewElement.querySelectorAll("[data-dz-thumbnail]"),i=0,a=s.length;a>i;i++)n=s[i],n.alt=e.name,n.src=t;return setTimeout(function(t){return function(){return e.previewElement.classList.add("dz-image-preview")}}(this),1)}},error:function(e,t){var n,i,a,s,r;if(e.previewElement){for(e.previewElement.classList.add("dz-error"),"String"!=typeof t&&t.error&&(t=t.error),s=e.previewElement.querySelectorAll("[data-dz-errormessage]"),r=[],i=0,a=s.length;a>i;i++)n=s[i],r.push(n.textContent=t);return r}},errormultiple:r,processing:function(e){return e.previewElement&&(e.previewElement.classList.add("dz-processing"),e._removeLink)?e._removeLink.textContent=this.options.dictCancelUpload:void 0},processingmultiple:r,uploadprogress:function(e,t,n){var i,a,s,r,o;if(e.previewElement){for(r=e.previewElement.querySelectorAll("[data-dz-uploadprogress]"),o=[],a=0,s=r.length;s>a;a++)i=r[a],"PROGRESS"===i.nodeName?o.push(i.value=t):o.push(i.style.width=""+t+"%");return o}},totaluploadprogress:r,sending:r,sendingmultiple:r,success:function(e){return e.previewElement?e.previewElement.classList.add("dz-success"):void 0},successmultiple:r,canceled:function(e){return this.emit("error",e,"Upload canceled.")},canceledmultiple:r,complete:function(e){return e._removeLink&&(e._removeLink.textContent=this.options.dictRemoveFile),e.previewElement?e.previewElement.classList.add("dz-complete"):void 0},completemultiple:r,maxfilesexceeded:r,maxfilesreached:r,queuecomplete:r,addedfiles:r,previewTemplate:'<div class="dz-preview dz-file-preview">\n  <div class="dz-image"><img data-dz-thumbnail /></div>\n  <div class="dz-details">\n    <div class="dz-size"><span data-dz-size></span></div>\n    <div class="dz-filename"><span data-dz-name></span></div>\n  </div>\n  <div class="dz-progress"><span class="dz-upload" data-dz-uploadprogress></span></div>\n  <div class="dz-error-message"><span data-dz-errormessage></span></div>\n  <div class="dz-success-mark">\n    <svg width="54px" height="54px" viewBox="0 0 54 54" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">\n      <title>Check</title>\n      <defs></defs>\n      <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage">\n        <path d="M23.5,31.8431458 L17.5852419,25.9283877 C16.0248253,24.3679711 13.4910294,24.366835 11.9289322,25.9289322 C10.3700136,27.4878508 10.3665912,30.0234455 11.9283877,31.5852419 L20.4147581,40.0716123 C20.5133999,40.1702541 20.6159315,40.2626649 20.7218615,40.3488435 C22.2835669,41.8725651 24.794234,41.8626202 26.3461564,40.3106978 L43.3106978,23.3461564 C44.8771021,21.7797521 44.8758057,19.2483887 43.3137085,17.6862915 C41.7547899,16.1273729 39.2176035,16.1255422 37.6538436,17.6893022 L23.5,31.8431458 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z" id="Oval-2" stroke-opacity="0.198794158" stroke="#747474" fill-opacity="0.816519475" fill="#FFFFFF" sketch:type="MSShapeGroup"></path>\n      </g>\n    </svg>\n  </div>\n  <div class="dz-error-mark">\n    <svg width="54px" height="54px" viewBox="0 0 54 54" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">\n      <title>Error</title>\n      <defs></defs>\n      <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage">\n        <g id="Check-+-Oval-2" sketch:type="MSLayerGroup" stroke="#747474" stroke-opacity="0.198794158" fill="#FFFFFF" fill-opacity="0.816519475">\n          <path d="M32.6568542,29 L38.3106978,23.3461564 C39.8771021,21.7797521 39.8758057,19.2483887 38.3137085,17.6862915 C36.7547899,16.1273729 34.2176035,16.1255422 32.6538436,17.6893022 L27,23.3431458 L21.3461564,17.6893022 C19.7823965,16.1255422 17.2452101,16.1273729 15.6862915,17.6862915 C14.1241943,19.2483887 14.1228979,21.7797521 15.6893022,23.3461564 L21.3431458,29 L15.6893022,34.6538436 C14.1228979,36.2202479 14.1241943,38.7516113 15.6862915,40.3137085 C17.2452101,41.8726271 19.7823965,41.8744578 21.3461564,40.3106978 L27,34.6568542 L32.6538436,40.3106978 C34.2176035,41.8744578 36.7547899,41.8726271 38.3137085,40.3137085 C39.8758057,38.7516113 39.8771021,36.2202479 38.3106978,34.6538436 L32.6568542,29 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z" id="Oval-2" sketch:type="MSShapeGroup"></path>\n        </g>\n      </g>\n    </svg>\n  </div>\n</div>'},i=function(){var e,t,n,i,a,s,r;for(i=arguments[0],n=2<=arguments.length?l.call(arguments,1):[],s=0,r=n.length;r>s;s++){t=n[s];for(e in t)a=t[e],i[e]=a}return i},n.prototype.getAcceptedFiles=function(){var e,t,n,i,a;for(i=this.files,a=[],t=0,n=i.length;n>t;t++)e=i[t],e.accepted&&a.push(e);return a},n.prototype.getRejectedFiles=function(){var e,t,n,i,a;for(i=this.files,a=[],t=0,n=i.length;n>t;t++)e=i[t],e.accepted||a.push(e);return a},n.prototype.getFilesWithStatus=function(e){var t,n,i,a,s;for(a=this.files,s=[],n=0,i=a.length;i>n;n++)t=a[n],t.status===e&&s.push(t);return s},n.prototype.getQueuedFiles=function(){return this.getFilesWithStatus(n.QUEUED)},n.prototype.getUploadingFiles=function(){return this.getFilesWithStatus(n.UPLOADING)},n.prototype.getAddedFiles=function(){return this.getFilesWithStatus(n.ADDED)},n.prototype.getActiveFiles=function(){var e,t,i,a,s;for(a=this.files,s=[],t=0,i=a.length;i>t;t++)e=a[t],(e.status===n.UPLOADING||e.status===n.QUEUED)&&s.push(e);return s},n.prototype.init=function(){var e,t,i,a,s,r,o;for("form"===this.element.tagName&&this.element.setAttribute("enctype","multipart/form-data"),this.element.classList.contains("dropzone")&&!this.element.querySelector(".dz-message")&&this.element.appendChild(n.createElement('<div class="dz-default dz-message"><span>'+this.options.dictDefaultMessage+"</span></div>")),this.clickableElements.length&&(i=function(e){return function(){return e.hiddenFileInput&&e.hiddenFileInput.parentNode.removeChild(e.hiddenFileInput),e.hiddenFileInput=document.createElement("input"),e.hiddenFileInput.setAttribute("type","file"),(null==e.options.maxFiles||e.options.maxFiles>1)&&e.hiddenFileInput.setAttribute("multiple","multiple"),e.hiddenFileInput.className="dz-hidden-input",null!=e.options.acceptedFiles&&e.hiddenFileInput.setAttribute("accept",e.options.acceptedFiles),null!=e.options.capture&&e.hiddenFileInput.setAttribute("capture",e.options.capture),e.hiddenFileInput.style.visibility="hidden",e.hiddenFileInput.style.position="absolute",e.hiddenFileInput.style.top="0",e.hiddenFileInput.style.left="0",e.hiddenFileInput.style.height="0",e.hiddenFileInput.style.width="0",document.querySelector(e.options.hiddenInputContainer).appendChild(e.hiddenFileInput),e.hiddenFileInput.addEventListener("change",function(){var t,n,a,s;if(n=e.hiddenFileInput.files,n.length)for(a=0,s=n.length;s>a;a++)t=n[a],e.addFile(t);return e.emit("addedfiles",n),i()})}}(this))(),this.URL=null!=(r=window.URL)?r:window.webkitURL,o=this.events,a=0,s=o.length;s>a;a++)e=o[a],this.on(e,this.options[e]);return this.on("uploadprogress",function(e){return function(){return e.updateTotalUploadProgress()}}(this)),this.on("removedfile",function(e){return function(){return e.updateTotalUploadProgress()}}(this)),this.on("canceled",function(e){return function(t){return e.emit("complete",t)}}(this)),this.on("complete",function(e){return function(t){return 0===e.getAddedFiles().length&&0===e.getUploadingFiles().length&&0===e.getQueuedFiles().length?setTimeout(function(){return e.emit("queuecomplete")},0):void 0}}(this)),t=function(e){return e.stopPropagation(),e.preventDefault?e.preventDefault():e.returnValue=!1},this.listeners=[{element:this.element,events:{dragstart:function(e){return function(t){return e.emit("dragstart",t)}}(this),dragenter:function(e){return function(n){return t(n),e.emit("dragenter",n)}}(this),dragover:function(e){return function(n){var i;try{i=n.dataTransfer.effectAllowed}catch(a){}return n.dataTransfer.dropEffect="move"===i||"linkMove"===i?"move":"copy",t(n),e.emit("dragover",n)}}(this),dragleave:function(e){return function(t){return e.emit("dragleave",t)}}(this),drop:function(e){return function(n){return t(n),e.drop(n)}}(this),dragend:function(e){return function(t){return e.emit("dragend",t)}}(this)}}],this.clickableElements.forEach(function(e){return function(t){return e.listeners.push({element:t,events:{click:function(i){return(t!==e.element||i.target===e.element||n.elementInside(i.target,e.element.querySelector(".dz-message")))&&e.hiddenFileInput.click(),!0}}})}}(this)),this.enable(),this.options.init.call(this)},n.prototype.destroy=function(){var e;return this.disable(),this.removeAllFiles(!0),(null!=(e=this.hiddenFileInput)?e.parentNode:void 0)&&(this.hiddenFileInput.parentNode.removeChild(this.hiddenFileInput),this.hiddenFileInput=null),delete this.element.dropzone,n.instances.splice(n.instances.indexOf(this),1)},n.prototype.updateTotalUploadProgress=function(){var e,t,n,i,a,s,r,o;if(i=0,n=0,e=this.getActiveFiles(),e.length){for(o=this.getActiveFiles(),s=0,r=o.length;r>s;s++)t=o[s],i+=t.upload.bytesSent,n+=t.upload.total;a=100*i/n}else a=100;return this.emit("totaluploadprogress",a,n,i)},n.prototype._getParamName=function(e){return"function"==typeof this.options.paramName?this.options.paramName(e):""+this.options.paramName+(this.options.uploadMultiple?"["+e+"]":"")},n.prototype.getFallbackForm=function(){var e,t,i,a;return(e=this.getExistingFallback())?e:(i='<div class="dz-fallback">',this.options.dictFallbackText&&(i+="<p>"+this.options.dictFallbackText+"</p>"),i+='<input type="file" name="'+this._getParamName(0)+'" '+(this.options.uploadMultiple?'multiple="multiple"':void 0)+' /><input type="submit" value="Upload!"></div>',t=n.createElement(i),"FORM"!==this.element.tagName?(a=n.createElement('<form action="'+this.options.url+'" enctype="multipart/form-data" method="'+this.options.method+'"></form>'),a.appendChild(t)):(this.element.setAttribute("enctype","multipart/form-data"),this.element.setAttribute("method",this.options.method)),null!=a?a:t)},n.prototype.getExistingFallback=function(){var e,t,n,i,a,s;for(t=function(e){var t,n,i;for(n=0,i=e.length;i>n;n++)if(t=e[n],/(^| )fallback($| )/.test(t.className))return t},s=["div","form"],i=0,a=s.length;a>i;i++)if(n=s[i],e=t(this.element.getElementsByTagName(n)))return e},n.prototype.setupEventListeners=function(){var e,t,n,i,a,s,r;for(s=this.listeners,r=[],i=0,a=s.length;a>i;i++)e=s[i],r.push(function(){var i,a;i=e.events,a=[];for(t in i)n=i[t],a.push(e.element.addEventListener(t,n,!1));return a}());return r},n.prototype.removeEventListeners=function(){var e,t,n,i,a,s,r;for(s=this.listeners,r=[],i=0,a=s.length;a>i;i++)e=s[i],r.push(function(){var i,a;i=e.events,a=[];for(t in i)n=i[t],a.push(e.element.removeEventListener(t,n,!1));return a}());return r},n.prototype.disable=function(){var e,t,n,i,a;for(this.clickableElements.forEach(function(e){return e.classList.remove("dz-clickable")}),this.removeEventListeners(),i=this.files,a=[],t=0,n=i.length;n>t;t++)e=i[t],a.push(this.cancelUpload(e));return a},n.prototype.enable=function(){return this.clickableElements.forEach(function(e){return e.classList.add("dz-clickable")}),this.setupEventListeners()},n.prototype.filesize=function(e){var t,n,i,a,s,r,o,l;if(i=0,a="b",e>0){for(r=["TB","GB","MB","KB","b"],n=o=0,l=r.length;l>o;n=++o)if(s=r[n],t=Math.pow(this.options.filesizeBase,4-n)/10,e>=t){i=e/Math.pow(this.options.filesizeBase,4-n),a=s;break}i=Math.round(10*i)/10}return"<strong>"+i+"</strong> "+a},n.prototype._updateMaxFilesReachedClass=function(){return null!=this.options.maxFiles&&this.getAcceptedFiles().length>=this.options.maxFiles?(this.getAcceptedFiles().length===this.options.maxFiles&&this.emit("maxfilesreached",this.files),this.element.classList.add("dz-max-files-reached")):this.element.classList.remove("dz-max-files-reached")},n.prototype.drop=function(e){var t,n;e.dataTransfer&&(this.emit("drop",e),t=e.dataTransfer.files,this.emit("addedfiles",t),t.length&&(n=e.dataTransfer.items,n&&n.length&&null!=n[0].webkitGetAsEntry?this._addFilesFromItems(n):this.handleFiles(t)))},n.prototype.paste=function(e){var t,n;if(null!=(null!=e&&null!=(n=e.clipboardData)?n.items:void 0))return this.emit("paste",e),t=e.clipboardData.items,t.length?this._addFilesFromItems(t):void 0},n.prototype.handleFiles=function(e){var t,n,i,a;for(a=[],n=0,i=e.length;i>n;n++)t=e[n],a.push(this.addFile(t));return a},n.prototype._addFilesFromItems=function(e){var t,n,i,a,s;for(s=[],i=0,a=e.length;a>i;i++)n=e[i],null!=n.webkitGetAsEntry&&(t=n.webkitGetAsEntry())?t.isFile?s.push(this.addFile(n.getAsFile())):t.isDirectory?s.push(this._addFilesFromDirectory(t,t.name)):s.push(void 0):null!=n.getAsFile&&(null==n.kind||"file"===n.kind)?s.push(this.addFile(n.getAsFile())):s.push(void 0);return s},n.prototype._addFilesFromDirectory=function(e,t){var n,i;return n=e.createReader(),i=function(e){return function(n){var i,a,s;for(a=0,s=n.length;s>a;a++)i=n[a],i.isFile?i.file(function(n){return e.options.ignoreHiddenFiles&&"."===n.name.substring(0,1)?void 0:(n.fullPath=""+t+"/"+n.name,e.addFile(n))}):i.isDirectory&&e._addFilesFromDirectory(i,""+t+"/"+i.name)}}(this),n.readEntries(i,function(e){return"undefined"!=typeof console&&null!==console&&"function"==typeof console.log?console.log(e):void 0})},n.prototype.accept=function(e,t){return e.size>1024*this.options.maxFilesize*1024?t(this.options.dictFileTooBig.replace("{{filesize}}",Math.round(e.size/1024/10.24)/100).replace("{{maxFilesize}}",this.options.maxFilesize)):n.isValidFile(e,this.options.acceptedFiles)?null!=this.options.maxFiles&&this.getAcceptedFiles().length>=this.options.maxFiles?(t(this.options.dictMaxFilesExceeded.replace("{{maxFiles}}",this.options.maxFiles)),this.emit("maxfilesexceeded",e)):this.options.accept.call(this,e,t):t(this.options.dictInvalidFileType)},n.prototype.addFile=function(e){return e.upload={progress:0,total:e.size,bytesSent:0},this.files.push(e),e.status=n.ADDED,this.emit("addedfile",e),this._enqueueThumbnail(e),this.accept(e,function(t){return function(n){return n?(e.accepted=!1,t._errorProcessing([e],n)):(e.accepted=!0,t.options.autoQueue&&t.enqueueFile(e)),t._updateMaxFilesReachedClass()}}(this))},n.prototype.enqueueFiles=function(e){var t,n,i;for(n=0,i=e.length;i>n;n++)t=e[n],this.enqueueFile(t);return null},n.prototype.enqueueFile=function(e){if(e.status!==n.ADDED||e.accepted!==!0)throw new Error("This file can't be queued because it has already been processed or was rejected.");return e.status=n.QUEUED,this.options.autoProcessQueue?setTimeout(function(e){return function(){return e.processQueue()}}(this),0):void 0},n.prototype._thumbnailQueue=[],n.prototype._processingThumbnail=!1,n.prototype._enqueueThumbnail=function(e){return this.options.createImageThumbnails&&e.type.match(/image.*/)&&e.size<=1024*this.options.maxThumbnailFilesize*1024?(this._thumbnailQueue.push(e),setTimeout(function(e){return function(){return e._processThumbnailQueue()}}(this),0)):void 0},n.prototype._processThumbnailQueue=function(){return this._processingThumbnail||0===this._thumbnailQueue.length?void 0:(this._processingThumbnail=!0,this.createThumbnail(this._thumbnailQueue.shift(),function(e){return function(){return e._processingThumbnail=!1,e._processThumbnailQueue()}}(this)))},n.prototype.removeFile=function(e){return e.status===n.UPLOADING&&this.cancelUpload(e),this.files=o(this.files,e),this.emit("removedfile",e),0===this.files.length?this.emit("reset"):void 0},n.prototype.removeAllFiles=function(e){var t,i,a,s;for(null==e&&(e=!1),s=this.files.slice(),i=0,a=s.length;a>i;i++)t=s[i],(t.status!==n.UPLOADING||e)&&this.removeFile(t);return null},n.prototype.createThumbnail=function(e,t){var n;return n=new FileReader,n.onload=function(i){return function(){return"image/svg+xml"===e.type?(i.emit("thumbnail",e,n.result),void(null!=t&&t())):i.createThumbnailFromUrl(e,n.result,t)}}(this),n.readAsDataURL(e)},n.prototype.createThumbnailFromUrl=function(e,t,n,i){var a;return a=document.createElement("img"),i&&(a.crossOrigin=i),a.onload=function(t){return function(){var i,r,o,l,c,d,u,p;return e.width=a.width,e.height=a.height,o=t.options.resize.call(t,e),null==o.trgWidth&&(o.trgWidth=o.optWidth),null==o.trgHeight&&(o.trgHeight=o.optHeight),i=document.createElement("canvas"),r=i.getContext("2d"),i.width=o.trgWidth,i.height=o.trgHeight,s(r,a,null!=(c=o.srcX)?c:0,null!=(d=o.srcY)?d:0,o.srcWidth,o.srcHeight,null!=(u=o.trgX)?u:0,null!=(p=o.trgY)?p:0,o.trgWidth,o.trgHeight),l=i.toDataURL("image/png"),t.emit("thumbnail",e,l),null!=n?n():void 0}}(this),null!=n&&(a.onerror=n),a.src=t},n.prototype.processQueue=function(){var e,t,n,i;if(t=this.options.parallelUploads,n=this.getUploadingFiles().length,e=n,!(n>=t)&&(i=this.getQueuedFiles(),i.length>0)){if(this.options.uploadMultiple)return this.processFiles(i.slice(0,t-n));for(;t>e;){if(!i.length)return;this.processFile(i.shift()),e++}}},n.prototype.processFile=function(e){return this.processFiles([e])},n.prototype.processFiles=function(e){var t,i,a;for(i=0,a=e.length;a>i;i++)t=e[i],t.processing=!0,t.status=n.UPLOADING,this.emit("processing",t);return this.options.uploadMultiple&&this.emit("processingmultiple",e),this.uploadFiles(e)},n.prototype._getFilesWithXhr=function(e){var t,n;return n=function(){var n,i,a,s;for(a=this.files,s=[],n=0,i=a.length;i>n;n++)t=a[n],t.xhr===e&&s.push(t);return s}.call(this)},n.prototype.cancelUpload=function(e){var t,i,a,s,r,o,l;if(e.status===n.UPLOADING){for(i=this._getFilesWithXhr(e.xhr),a=0,r=i.length;r>a;a++)t=i[a],t.status=n.CANCELED;for(e.xhr.abort(),s=0,o=i.length;o>s;s++)t=i[s],this.emit("canceled",t);this.options.uploadMultiple&&this.emit("canceledmultiple",i)}else((l=e.status)===n.ADDED||l===n.QUEUED)&&(e.status=n.CANCELED,this.emit("canceled",e),this.options.uploadMultiple&&this.emit("canceledmultiple",[e]));return this.options.autoProcessQueue?this.processQueue():void 0},a=function(){var e,t;return t=arguments[0],e=2<=arguments.length?l.call(arguments,1):[],"function"==typeof t?t.apply(this,e):t},n.prototype.uploadFile=function(e){return this.uploadFiles([e])},n.prototype.uploadFiles=function(e){var t,s,r,o,l,c,d,u,p,m,h,g,v,f,b,k,y,w,A,E,T,C,S,F,_,$,U,x,I,z,M,L,P,D;for(A=new XMLHttpRequest,E=0,F=e.length;F>E;E++)t=e[E],t.xhr=A;g=a(this.options.method,e),y=a(this.options.url,e),A.open(g,y,!0),A.withCredentials=!!this.options.withCredentials,b=null,r=function(n){return function(){var i,a,s;for(s=[],i=0,a=e.length;a>i;i++)t=e[i],s.push(n._errorProcessing(e,b||n.options.dictResponseError.replace("{{statusCode}}",A.status),A));return s}}(this),k=function(n){return function(i){var a,s,r,o,l,c,d,u,p;if(null!=i)for(s=100*i.loaded/i.total,r=0,c=e.length;c>r;r++)t=e[r],t.upload={progress:s,total:i.total,bytesSent:i.loaded};else{for(a=!0,s=100,o=0,d=e.length;d>o;o++)t=e[o],(100!==t.upload.progress||t.upload.bytesSent!==t.upload.total)&&(a=!1),t.upload.progress=s,t.upload.bytesSent=t.upload.total;if(a)return}for(p=[],l=0,u=e.length;u>l;l++)t=e[l],p.push(n.emit("uploadprogress",t,s,t.upload.bytesSent));return p}}(this),A.onload=function(t){return function(i){var a;if(e[0].status!==n.CANCELED&&4===A.readyState){if(b=A.responseText,A.getResponseHeader("content-type")&&~A.getResponseHeader("content-type").indexOf("application/json"))try{b=JSON.parse(b)}catch(s){i=s,b="Invalid JSON response from server."}return k(),200<=(a=A.status)&&300>a?t._finished(e,b,i):r()}}}(this),A.onerror=function(t){return function(){return e[0].status!==n.CANCELED?r():void 0}}(this),f=null!=(I=A.upload)?I:A,f.onprogress=k,c={Accept:"application/json","Cache-Control":"no-cache","X-Requested-With":"XMLHttpRequest"},this.options.headers&&i(c,this.options.headers);for(o in c)l=c[o],l&&A.setRequestHeader(o,l);if(s=new FormData,this.options.params){z=this.options.params;for(h in z)w=z[h],s.append(h,w)}for(T=0,_=e.length;_>T;T++)t=e[T],this.emit("sending",t,A,s);if(this.options.uploadMultiple&&this.emit("sendingmultiple",e,A,s),"FORM"===this.element.tagName)for(M=this.element.querySelectorAll("input, textarea, select, button"),C=0,$=M.length;$>C;C++)if(u=M[C],p=u.getAttribute("name"),m=u.getAttribute("type"),"SELECT"===u.tagName&&u.hasAttribute("multiple"))for(L=u.options,S=0,U=L.length;U>S;S++)v=L[S],v.selected&&s.append(p,v.value);else(!m||"checkbox"!==(P=m.toLowerCase())&&"radio"!==P||u.checked)&&s.append(p,u.value);for(d=x=0,D=e.length-1;D>=0?D>=x:x>=D;d=D>=0?++x:--x)s.append(this._getParamName(d),e[d],e[d].name);return this.submitRequest(A,s,e)},n.prototype.submitRequest=function(e,t,n){return e.send(t)},n.prototype._finished=function(e,t,i){var a,s,r;for(s=0,r=e.length;r>s;s++)a=e[s],a.status=n.SUCCESS,this.emit("success",a,t,i),this.emit("complete",a);return this.options.uploadMultiple&&(this.emit("successmultiple",e,t,i),this.emit("completemultiple",e)),this.options.autoProcessQueue?this.processQueue():void 0},n.prototype._errorProcessing=function(e,t,i){var a,s,r;for(s=0,r=e.length;r>s;s++)a=e[s],a.status=n.ERROR,this.emit("error",a,t,i),this.emit("complete",a);return this.options.uploadMultiple&&(this.emit("errormultiple",e,t,i),this.emit("completemultiple",e)),this.options.autoProcessQueue?this.processQueue():void 0},n}(t),e.version="4.2.0",e.options={},e.optionsForElement=function(t){return t.getAttribute("id")?e.options[n(t.getAttribute("id"))]:void 0},e.instances=[],e.forElement=function(e){if("string"==typeof e&&(e=document.querySelector(e)),null==(null!=e?e.dropzone:void 0))throw new Error("No Dropzone found for given element. This is probably because you're trying to access it before Dropzone had the time to initialize. Use the `init` option to setup any additional observers on your Dropzone.");
return e.dropzone},e.autoDiscover=!0,e.discover=function(){var t,n,i,a,s,r;for(document.querySelectorAll?i=document.querySelectorAll(".dropzone"):(i=[],t=function(e){var t,n,a,s;for(s=[],n=0,a=e.length;a>n;n++)t=e[n],/(^| )dropzone($| )/.test(t.className)?s.push(i.push(t)):s.push(void 0);return s},t(document.getElementsByTagName("div")),t(document.getElementsByTagName("form"))),r=[],a=0,s=i.length;s>a;a++)n=i[a],e.optionsForElement(n)!==!1?r.push(new e(n)):r.push(void 0);return r},e.blacklistedBrowsers=[/opera.*Macintosh.*version\/12/i],e.isBrowserSupported=function(){var t,n,i,a,s;if(t=!0,window.File&&window.FileReader&&window.FileList&&window.Blob&&window.FormData&&document.querySelector)if("classList"in document.createElement("a"))for(s=e.blacklistedBrowsers,i=0,a=s.length;a>i;i++)n=s[i],n.test(navigator.userAgent)&&(t=!1);else t=!1;else t=!1;return t},o=function(e,t){var n,i,a,s;for(s=[],i=0,a=e.length;a>i;i++)n=e[i],n!==t&&s.push(n);return s},n=function(e){return e.replace(/[\-_](\w)/g,function(e){return e.charAt(1).toUpperCase()})},e.createElement=function(e){var t;return t=document.createElement("div"),t.innerHTML=e,t.childNodes[0]},e.elementInside=function(e,t){if(e===t)return!0;for(;e=e.parentNode;)if(e===t)return!0;return!1},e.getElement=function(e,t){var n;if("string"==typeof e?n=document.querySelector(e):null!=e.nodeType&&(n=e),null==n)throw new Error("Invalid `"+t+"` option provided. Please provide a CSS selector or a plain HTML element.");return n},e.getElements=function(e,t){var n,i,a,s,r,o,l,c;if(e instanceof Array){a=[];try{for(s=0,o=e.length;o>s;s++)i=e[s],a.push(this.getElement(i,t))}catch(d){n=d,a=null}}else if("string"==typeof e)for(a=[],c=document.querySelectorAll(e),r=0,l=c.length;l>r;r++)i=c[r],a.push(i);else null!=e.nodeType&&(a=[e]);if(null==a||!a.length)throw new Error("Invalid `"+t+"` option provided. Please provide a CSS selector, a plain HTML element or a list of those.");return a},e.confirm=function(e,t,n){return window.confirm(e)?t():null!=n?n():void 0},e.isValidFile=function(e,t){var n,i,a,s,r;if(!t)return!0;for(t=t.split(","),i=e.type,n=i.replace(/\/.*$/,""),s=0,r=t.length;r>s;s++)if(a=t[s],a=a.trim(),"."===a.charAt(0)){if(-1!==e.name.toLowerCase().indexOf(a.toLowerCase(),e.name.length-a.length))return!0}else if(/\/\*$/.test(a)){if(n===a.replace(/\/.*$/,""))return!0}else if(i===a)return!0;return!1},"undefined"!=typeof jQuery&&null!==jQuery&&(jQuery.fn.dropzone=function(t){return this.each(function(){return new e(this,t)})}),"undefined"!=typeof module&&null!==module?module.exports=e:window.Dropzone=e,e.ADDED="added",e.QUEUED="queued",e.ACCEPTED=e.QUEUED,e.UPLOADING="uploading",e.PROCESSING=e.UPLOADING,e.CANCELED="canceled",e.ERROR="error",e.SUCCESS="success",a=function(e){var t,n,i,a,s,r,o,l,c,d;for(o=e.naturalWidth,r=e.naturalHeight,n=document.createElement("canvas"),n.width=1,n.height=r,i=n.getContext("2d"),i.drawImage(e,0,0),a=i.getImageData(0,0,1,r).data,d=0,s=r,l=r;l>d;)t=a[4*(l-1)+3],0===t?s=l:d=l,l=s+d>>1;return c=l/r,0===c?1:c},s=function(e,t,n,i,s,r,o,l,c,d){var u;return u=a(t),e.drawImage(t,n,i,s,r,o,l,c,d/u)},i=function(e,t){var n,i,a,s,r,o,l,c,d;if(a=!1,d=!0,i=e.document,c=i.documentElement,n=i.addEventListener?"addEventListener":"attachEvent",l=i.addEventListener?"removeEventListener":"detachEvent",o=i.addEventListener?"":"on",s=function(n){return"readystatechange"!==n.type||"complete"===i.readyState?(("load"===n.type?e:i)[l](o+n.type,s,!1),!a&&(a=!0)?t.call(e,n.type||n):void 0):void 0},r=function(){var e;try{c.doScroll("left")}catch(t){return e=t,void setTimeout(r,50)}return s("poll")},"complete"!==i.readyState){if(i.createEventObject&&c.doScroll){try{d=!e.frameElement}catch(u){}d&&r()}return i[n](o+"DOMContentLoaded",s,!1),i[n](o+"readystatechange",s,!1),e[n](o+"load",s,!1)}},e._autoDiscoverFunction=function(){return e.autoDiscover?e.discover():void 0},i(window,e._autoDiscoverFunction)}.call(void 0),function(){angular.module("AiliBot").constant("appRouter",function(e){e.state("home",{url:"/?anything",data:{needAuth:!1}}).state("app",{url:"/app","abstract":!0,templateUrl:"templates/main.html",controller:"MainController"}).state("app.login",{url:"/login",cache:!1,data:{needAuth:!1},views:{viewContent:{resolve:{redirect:["Auth",function(e){location.href=e.wechatAuth.getAuthUrl()}]}}}}).state("app.wechatAuthCallback",{url:"/wechat_auth_callback?code",cache:!1,data:{needAuth:!1},views:{viewContent:{template:'<ion-view view-title="小板凳"><ion-content><div class="loader"><p class="size-m">登录中</p><ion-spinner></ion-spinner></div></ion-content></ion-view>',controller:"WechatAuthCallbackController"}}}).state("app.reauth",{url:"/reauth?reauthUuid",cache:!1,data:{needAuth:!1},resolve:{reauth:["Auth","$stateParams","$state",function(e,t,n){e.login({unionid:t.reauthUuid}).then(function(){var t=e.getReturnTo();console.log("relogged in!"),t&&n.go(t.state.name,t.params)},function(e){console.log(e)})}]}}).state("app.chat",{url:"/chat",cache:!0,data:{needAuth:!1},resolve:{auth:["Auth",function(e){return e.isLogin()?!0:e.login({username:"Yujun",password:"p@ssword#1"})}]},views:{viewContent:{templateUrl:"templates/chat.html",controller:"ChatController"}}})})}(),angular.module("AiliBot").factory("_",["$window",function(e){return e._}]),function(){angular.module("AiliBot").factory("AudioContext",function(){return window.AudioContext||window.webkitAudioContext?new(window.AudioContext||window.webkitAudioContext):null})}(),function(){angular.module("AiliBot").service("Auth",["API_ENDPOINT","$q","$http","LocalStorage","LeanCloud","Util",function(e,t,n,i,a,s){var r=this,o=(e.port?e.host+":"+e.port+e.path:e.host+e.path,{config:{appid:"wxe74948cd9929edc4",redirectUri:encodeURIComponent("http://xiaobandeng.palmdrive.cn/app/wechat_auth_callback/"),baseUrlForCode:"https://open.weixin.qq.com/connect/oauth2/authorize",scope:"snsapi_userinfo"},getAuthUrl:function(){return this.config.baseUrlForCode+"?appid="+this.config.appid+"&redirect_uri="+this.config.redirectUri+"&response_type=code&scope="+this.config.scope+"#wechat_redirect"},getWechatUserInfoAndLogin:function(e){}}),l=function(e){e=e||r.getCurrentUser(),n.defaults.headers.common["X-Ailibot-Token"]=e.get("token")};this.getCurrentUser=function(){var e=a.User.current();return e},this.setCurrentUser=function(e){this.currentUser=e,i.set("currentUser",e)},this.getReturnTo=function(){return i.get("returnTo")},this.setReturnTo=function(e){null===e?i.remove("returnTo"):i.set("returnTo",e)},this.getWxUnionid=function(){var e=window.jwt_decode(this.currentUser.accessToken);return e.wxUnionid},this.isLogin=function(){var e=this.getCurrentUser();return null!==e&&"undefined"!=typeof e&&!_.isEmpty(e)},this.signup=function(e){var t=new a.User;return t.setUsername(e.username),t.setPassword(e.password),t.set("token",s.genRandomStr()),e.headimgurl&&t.set("headimgurl",e.headimgurl),t.signUp().then(function(e){return l(e),e})},this.login=function(e){return a.User.logIn(e.username,e.password).then(function(e){return l(e),e})},this.setHttpHeaders=l,this.wechatAuth=o}])}(),function(){angular.module("AiliBot").factory("FirebaseRef",["FIREBASE_APP",function(e){return{}}])}();var Factory=function(){var e=function t(){_classCallCheck(this,t)};return e};angular.module("AiliBot").factory("LCBaseModel",Factory),angular.module("AiliBot").factory("LeanCloud",["LEAN_CLOUD",function(e){return AV.init({appId:e.appId,appKey:e.appKey}),AV}]),function(){var e={_store:{},_set:function(e,t){e=e.replace(/\/$/,"");var n=e.split("/"),i=n.pop(),a=n.join("/"),s=""===a?this._store:this.get(a);if(null===s)throw new Error("the value of "+a+" is null");if(!_.isObject(s)||_.isArray(s))throw new Error("the value of "+a+" is "+s+". It should be hash map.");return s[i]=t,s},_getParentPath:function(e){if(!e||!e.match(/\//))return e;var t=e.split("/"),n=t.slice(0,t.length).join("/");return n},set:function(e,t){e=e.replace(/\/$/,"");var n,i=e.split("/"),a=this,s="";return _.each(i,function(e,r){s+=e+"/",n=a.get(s),(!_.isObject(n)||_.isArray(n))&&(r===i.length-1?a._set(s,t):a._set(s,{}))}),this.get(this._getParentPath(e))},update:function(e,t){e=e.replace(/\/$/,"");var n=this.get(e);if(null===n)throw new Error("the value of "+e+" is null");if(_.isObject(n)&&!_.isArray(n)){if(!_.isObject(t))throw new Error("value should be hash map");return _.extend(n,t),n}var i=this._getParentPath(e);this.set(i,t)},get:function(t,n){if(""===t)return n;(null===n||"undefined"==typeof n)&&(n=e._store);var i,a=t.split("/"),s=a.shift();return n.hasOwnProperty(s)?(i=n[s],this.get(a.join("/"),i)):null}};angular.module("AiliBot").factory("LocalFB",function(){return e})}(),function(){function e(e){try{var t=window[e],n="__storage_test__";return t.setItem(n,n),t.removeItem(n),!0}catch(i){return!1}}var t=function(){var t="AiliBot";return this.isAvailable=e("localStorage"),this.set=function(e,n){return this.isAvailable?(localStorage.setItem(t+":"+e,JSON.stringify(n)),n):void 0},this.get=function(e){if(this.isAvailable){var n=localStorage.getItem(t+":"+e);if(n&&"undefined"!==n)return JSON.parse(n)}},this.remove=function(e){this.isAvailable&&localStorage.removeItem(t+":"+e)},this};angular.module("AiliBot").service("LocalStorage",t)}();var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();!function(){var e=function(e,t){var n=function(){function t(e){_classCallCheck(this,t),("undefined"==typeof e.id||null===e.id)&&(e.id=""),this._properties=Object.keys(e);for(var n in e)this[n]=e[n];return this}return _createClass(t,[{key:"toJSON",value:function(){var e=this,t={};return this._properties.forEach(function(n){t[n]=e[n]}),t}}],[{key:"init",value:function(){var n=e.getCurrentUser(),i={id:null,attributes:{type:0,content:"",senderId:n.id,receiverId:"aili_bot"},relationships:{user:{data:{id:n.id,attributes:{username:n.get("username"),headimgurl:n.get("headimgurl")}}}}};return new t(i)}}]),t}();return n};e.$inject=["Auth","LocalStorage"];var t=function(e,t,n,i,a,s){var r=function(){function r(){_classCallCheck(this,r);var e="ws"+i.url.replace("http","")+"/messages";return console.log("dataURL: "+e),this._dataStream=a(e),this.data=[],this.allFetched=!1,this._init(),this}return _createClass(r,[{key:"_init",value:function(){var t=this;this._dataStream.onMessage(function(i){console.log("new message came in!"),console.log(i);var a=JSON.parse(i.data);switch(a.action){case"get":break;default:t.data.push(new e(a.data)),n.$broadcast("scMessage:add")}})}},{key:"fetch",value:function(n){var a=this,s={limit:20,orderBy:"createdAt"},r=i.url+"/messages";return _.extend(s,n),t.get(r,{params:s}).then(function(t){return t.data&&(a.data=t.data.data.map(function(t){return new e(t)}).concat(a.data),t.data.data.length<s.limit&&(a.allFetched=!0)),a.data})}},{key:"save",value:function(e){if(!s.isLogin())throw alert("没有登陆"),new Error("没用登陆");var t=s.getCurrentUser();return this.data.push(e),this._dataStream.send({action:"post",data:e.toJSON(),token:t.get("token")})}}]),r}();return r};t.$inject=["Message","$http","$rootScope","API_ENDPOINT","$websocket","Auth"],angular.module("AiliBot").factory("Message",e),angular.module("AiliBot").factory("MessagesCollection",t)}(),function(){var e=function(e,t,n,i){var a={bucket:t.bucket,endpoint:"http://oss-cn-hangzhou.aliyuncs.com",chunkSize:1e7,concurrency:5,stsToken:""},s="img-cn-hangzhou.aliyuncs.com";this.url="http://"+t.bucket+"."+s,this.getFileOSSUrl=function(e){return"http://"+a.endpoint.replace("http://",a.bucket+".")+"/"+e},this.init=function(e){return this.setSTSToken().then(function(){return new OssUpload(a)})},this.setSTSToken=function(){return n.get(i.url+"/aliyun_sts").then(function(e){return a.stsToken=e.data})}};e.$inject=["$q","OSS_CONFIG","$http","API_ENDPOINT"],angular.module("AiliBot").service("OssUploadService",e)}(),function(){var e=function(){return{isIOSDevice:function(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream},genRandomStr:function(){return Math.random().toString(36).substring(5)+"-"+ +new Date},isMobile:function(){var e=768;return window.innerWidth<=e},isWeChat:function(){var e=navigator.userAgent.toLowerCase();return/micromessenger/.test(e)?!0:!1},formattedDuration:function(e){e=Math.round(e);var t,n,i=Math.floor(e/3600);return e-=3600*i,t=Math.floor(e/60),n=e-60*t,[("0"+i).slice(-2),("0"+t).slice(-2),("0"+n).slice(-2)].join(":")}}};angular.module("AiliBot").factory("Util",e)}(),function(){function e(e){var n=t(e);return n.buffer}function t(e){for(var t=window.atob(e),n=t.length,i=new Uint8Array(n),a=0;n>a;a++)i[a]=t.charCodeAt(a);return i}function n(e){e=e.split(",");var n=e[0].split(":")[1].split(";")[0],i=t(e[1]);return new Blob([i],{type:n})}function i(e,t){var n=t.createBufferSource();return n.buffer=e,n.connect(t.destination),n.start(0),n}angular.module("AiliBot").factory("WebAudio",["$q","AudioContext",function(t,a){var s=function(e,t,n){return this.elem=e,this.AudioContext=a,this.type=a?n||0:2,this.options=t||{},this};return s.prototype.init=function(){var i=this,s=this.elem.getAttribute("ng-src");return 0!==this.type&&this.elem.addEventListener("ended",function(){i.options.onended.call(i)}),t(function(t){switch(i.type){case 0:setTimeout(function(){var n=s.split(",")[1];a.decodeAudioData(e(n),function(e){i.buffer=e,t()})},500);break;case 1:i.elem.src=URL.createObjectURL(n(s)),t()}})},s.prototype.play=function(){var e=null,t=this;switch(this.type){case 0:e=i(this.buffer,this.AudioContext),e.onended=function(){t.options.onended.call(t)};break;default:this.elem.play()}return this.source=e,e},s.prototype.stop=function(){switch(this.type){case 0:this.source.stop(0);break;default:this.elem.pause(),this.elem.currentTime=0}},s}])}(),angular.module("AiliBot").controller("MainController",["$scope",function(e){}]),angular.module("AiliBot").controller("ChatController",["$scope","$stateParams","$timeout","$ionicScrollDelegate","$ionicNavBarDelegate","$rootScope","MessagesCollection","Auth","AudioContext","Util",function(e,t,n,i,a,s,r,o,l,c){var d=i.$getByHandle("messagesScroll"),u=null,p=!1,m=null;e.model={currentUser:o.currentUser},e.messagesLoaded=!1,e.messages=new r,e.messages.fetch({limit:20}).then(function(){n(function(){e.messagesLoaded=!0},500)}),e.fetchMoreMessages=function(){return 0!==e.messages.data.length&&e.messagesLoaded?e.messages.fetch({where:{createdAt:{$lt:e.messages.data[0].attributes.createdAt}}}).then(function(){e.$broadcast("scroll.infiniteScrollComplete")}):e.$broadcast("scroll.infiniteScrollComplete")},e.$on("$ionicView.enter",function(){d.scrollBottom(!0)}),e.$on("$ionicView.beforeEnter",function(){}),e.$on("$ionicView.leave",function(){}),e.$on("scMessage:add",function(){u&&(clearTimeout(u),u=null),u=setTimeout(function(){(null===m||m<=d.getScrollPosition().top)&&(d.resize(),d.scrollBottom(),setTimeout(function(){m=d.getScrollPosition().top},200))},500)}),e.onScroll=function(){p||(e.$broadcast("scroll:start"),p=!0)},e.onScrollComplete=function(){p=!1}}]),function(){angular.module("AiliBot").directive("scAniInput",["$interval",function(e){return{restrict:"E",template:'<input class="ani-input" placeholder="search...." type="text" name="ani-input" ng-model="search">',scope:{value:"@"},link:function(t,n,i){var a=t.value,s=-1;e(function(){-1===s?t.search="":t.search+=a[s],s+=1,s>=a.length&&(s=-1)},100)}}}])}(),function(){angular.module("AiliBot").controller("WechatAuthCallbackController",["$scope","Auth","$stateParams","$state","$ionicNavBarDelegate","AudioContext",function(e,t,n,i,a,s){var r=t.getReturnTo(),o=n.code,l=r&&r.params;e.$on("$ionicView.enter",function(){a.showBackButton(!1)}),o?t.wechatAuth.getWechatUserInfoAndLogin(o).then(function(){console.log("logged in!"),r&&(null===s&&_.extend(l,{reauthUuid:t.getWxUnionid()}),i.go(r.state.name,l))},function(e){console.log(e)}):alert("微信登陆失败")}])}(),function(){var e=function(e){return{restrict:"EA",replace:!0,templateUrl:"templates/scAppBanner.html",scope:{download:"&"}}};e.$inject=["$timeout"],angular.module("AiliBot").directive("scAppBanner",e)}(),function(){var e=function(e,t,n,i){return{restrict:"EA",templateUrl:"templates/scChatInput.html",replace:!0,scope:{messages:"=",messagesContainerId:"@"},link:function(e,a){var s=$(a[0]).find("#chat-text-input"),r=$(e.messagesContainerId),o=t.$getByHandle(r.attr("delegate-handle"));n.getCurrentUser();e.sendingMessage=!1,e.message=i.init(),e.mode=1,e.$on("elastic:resize",function(){var e=void 0;setTimeout(function(){$(a[0]).height()&&(e=$(a[0]).innerHeight()+"px",r.css({bottom:e})),o.scrollBottom(!0)},400)}),s.on("focus",function(){setTimeout(function(){o.scrollBottom(!0)},500)}),e.$on("$destroy",function(){s.off("focus")}),e.changeMode=function(){},e.sendMessage=function(t){t.preventDefault(),!e.sendingMessage&&e.message.attributes.content.trim().length&&(e.sendingMessage=!0,e.messages.save(e.message).then(function(){e.sendingMessage=!1}),e.message=i.init(),s[0].focus())}}}};e.$inject=["$timeout","$ionicScrollDelegate","Auth","Message"],angular.module("AiliBot").directive("scChatInput",e)}(),function(){angular.module("AiliBot").directive("scBackgroundContainer",function(){return function(e,t,n){var i=$(t[0]),a=i.width()*+n.ratio,s=+n.opacity||1;i.height(a),n.backgroundImage&&i.css({"background-image":"url("+n.backgroundImage+")","background-size":"cover",opacity:s})}})}(),function(){var e=function(e){function t(t,n,i,a){function s(){if(!p){var e=parseInt(i.distance)||5;if(u){var t=d.scrollView.getValues();t.top<=e&&(l=d.scrollView.getScrollMax().top,r())}else m.scrollTop<=e&&r()}}function r(){ionic.requestAnimationFrame(function(){n[0].classList.add("active")}),p=!0,t.$parent&&t.$parent.$apply(i.onInfinite||"")}function o(){ionic.requestAnimationFrame(function(){n[0].classList.remove("active")}),e(function(){u&&(d.scrollView.resize(),c=d.scrollView.getScrollMax().top,c>l&&d.scrollView.scrollTo(0,c-l,!1)),(u&&d.scrollView.__container&&d.scrollView.__container.offsetHeight>0||!u)&&h()},30,!1),p=!1}var l,c,d=a[0],u=!d.isNative(),p=!1;if(!u)var m=ionic.DomUtil.getParentOrSelfWithClass($element[0].parentNode,"overflow-scroll");var h=ionic.Utils.throttle(s,300);d.$element.on("scroll",h),t.$on("scroll.infiniteScrollComplete",function(){o()}),t.$on("$destroy",function(){d&&d.$element&&d.$element.off("scroll",h),m&&m.removeEventListener&&m.removeEventListener("scroll",h)})}return{restrict:"E",scope:!0,require:["?^$ionicScroll"],template:function(e,t){return t.icon?'<div class="loader"><i class="icon {{icon()}} icon-refreshing {{scrollingType}}"></i></div>':'<div class="loader"><ion-spinner icon="{{spinner()}}"></ion-spinner></div>'},link:t}};e.$inject=["$timeout"],angular.module("AiliBot").directive("infiniteScrollTop",e)}(),function(){var e=function(){return{restrict:"EA",templateUrl:"templates/scMessage.html",replace:!0,scope:{model:"="},controller:["$scope","Auth","$sce",function(e,t,n){e.currentUser=t.getCurrentUser(),e.trustedResourceUrl=function(e){return n.trustAsResourceUrl(e)}}]}};angular.module("AiliBot").directive("scMessage",e)}(),function(){function e(e){var t=parseInt(e/60).toString(),n=(e%60).toString();return 1===n.length&&(n="0"+n),[t,":",n].join("")}var t=function(){this._initTime=(new Date).getTime()};t.prototype.send=function(e){var t=((new Date).getTime()-this._initTime)/1e3/e;t=Math.ceil(100*t)/100,ga("send","timing","voice downloading duration","downloading time vs voice length",t)};var n=function(n,i,a,s,r,o){return{restrict:"EA",templateUrl:"templates/scVoice.html",scope:{model:"="},link:function(o,l){function c(){angular.isDefined(p)&&(i.cancel(p),o.frameIndex=3,p=void 0)}function d(){c(),o.playing=!1,o.$apply(),b.attr("id")===r.lastPlayed.msgEl.attr("id")&&(r.lastPlayed.isPlaying=!1),!h&&r.batch.loaded&&g&&r.findNextAndPlay(b),h=!1}var u,p,m=l[0].getElementsByTagName("audio")[0],h=!1,g=0===o.model.user.status,v=o.model.isAuthor&&g,f=r.batch.lastMessage&&r.batch.lastMessage.createdAt<o.model.createdAt,b=$(l[0]).parents(".sc-message-view"),k=n.child(o.model.content),y=new t;o.playing=!1,o.frameIndex=3,m.onloadedmetadata=function(){o.loaded=!0,o.voiceLength=e(Math.round(this.duration)),o.$digest(),y.send(this.duration),u=new a(m,{onended:d}),u.init().then(function(){g&&!r.lastPlayed.isPlaying&&f&&!v&&o.togglePlay(),r.batchLoaded(o.model)&&(r.batch.loaded=!0)})},k.on("value",function(e){var t=e.val();t&&(k.off("value"),o.voiceData=s.trustAsResourceUrl("data:audio/aac;base64,"+e.val()),o.$digest())}),o.$on("$destroy",function(){c(),k.off("value")}),o.$on("scMessage:stopVoicePlay",function(){o.playing&&o.togglePlay()}),o.togglePlay=function(){o.loaded&&(o.playing?(h=!0,u.stop()):(r.findPreviousAndStop(),u.play(),o.model.isHeard||o.model.setIsHeard(),r.lastPlayed.msgEl=b,r.lastPlayed.isPlaying=!0,p=i(function(){o.frameIndex=o.frameIndex%3+1},500)),o.playing=!o.playing)}}}};n.$inject=["FirebaseRef","$interval","WebAudio","$sce","VoiceAutoPlay","Auth"],angular.module("AiliBot").directive("scVoice",n)}(),function(){var e=function(e,t,n,i,a){return{restrict:"EA",scope:{talk:"="},templateUrl:"templates/scFeaturedTalkEditor.html",link:function(s){function r(e){function i(n){var i=o.getOssUploadOptions({name:e.name,file:n,key:e.key,scope:s,alertContainer:".admin-page"});s.$apply(function(){s[e.name+"Uploading"].processing=!0}),t.init().then(function(e){e.upload(i)},function(e){console.log(e),a.create({message:"Oops!出错了!",type:"error"})})}return new Dropzone(e.elementId,{url:"nourl",autoProcessQueue:!1,acceptedFiles:e.acceptedFiles,previewTemplate:n('<div><div class="dz-preview loader"><div>正在上传</div><ion-spinner></ion-spinner></div></div>')(s).html(),init:function(){this.on("addedfile",i)}})}var o=new e(s.talk.id);s.bannerImgUploading={processing:!1,percentage:"0%"},i(function(){r({elementId:"#banner-img-dropzone-"+s.talk.id,acceptedFiles:"image/*",name:"bannerImg",key:"talks/talk_"+s.talk.id+"/banner_img_"+ +new Date+".jpg"})},500)}}};e.$inject=["SCGroup","OssUploadService","$compile","$timeout","ywAlert"],angular.module("AiliBot").directive("scFeaturedTalkEditor",e)}();var dir=function(){return{restrict:"EA",scope:{model:"=",save:"&"},templateUrl:"templates/scNotification.html",replace:!0,controller:["$scope","ywAlert",function(e,t){e.mode=0,e.gotoEditMode=function(){0===e.mode&&(e.mode=1)},e.gotoReadMode=function(t){t.stopPropagation(),e.mode=0},e.update=function(n){n.stopPropagation(),e.save().then(function(){t.create({message:"更新成功"}),e.mode=0},function(e){t.create({message:"出错了，更新失败",type:"error"})})}}]}};angular.module("AiliBot").directive("scNotification",dir),function(){function e(e){return _.filter(e,function(e){return e.solid}).length}function t(e,t,n){for(var i=0;t>=i;i++)e[i].solid=n;return e}var n=function(n,i,a,s,r,o){var l=s.child("messages/"+n.groupId);n.stars=[{solid:!1},{solid:!1},{solid:!1},{solid:!1},{solid:!1}],n.review={rating:null,content:null},n.toggleStar=function(i,a){if(i.solid){var s=e(n.stars);s>0&&t(n.stars,s-1,!1),s>a+1&&t(n.stars,a,!0)}else t(n.stars,a,!0);n.review.rating=e(n.stars)},n.submit=function(){if(n.form.$submitted=!0,n.form.$valid){var e=o.get("users/"+r.currentUser.id),t=e&&e.attributes.nickname,s=a.show({title:"递交中......",template:'<div class="loader"><ion-spinner></ion-spinner></div>'});new i({groupId:n.groupId}).save(n.review).then(function(){l.push({content:(t?t:"用户")+"已给该讲座评分",type:6,createdAt:Firebase.ServerValue.TIMESTAMP,updatedAt:Firebase.ServerValue.TIMESTAMP}),s.close(),n.modalDelegate.hide()},function(){s.close(),alert("出错了，请稍微再试")})}}};n.$inject=["$scope","Review","$ionicPopup","FirebaseRef","Auth","LocalFB"];var i=function(){return{restrict:"EA",replace:!0,scope:{groupId:"@",modalDelegate:"="},templateUrl:"templates/scReviewNew.html",controller:n}};angular.module("AiliBot").directive("scReviewNew",i)}(),function(){var e=function(e,t){var n;e.$watch("group.status",function(i,a){void 0===a&&void 0!==i&&(e.now=(new Date).getTime(),(e.group.isStarting()||1===e.group.status)&&(n=t(function(){e.now+=1e3},1e3))),0!==a&&1!==a||2!==i&&3!==i&&4!==i||n&&t.cancel(n)}),e.$on("$destroy",function(){n&&t.cancel(n)})};e.$inject=["$scope","$interval"];var t=function(){return{restrict:"EA",replace:!0,templateUrl:"templates/scStatusBar.html",scope:{group:"="},controller:e}};angular.module("AiliBot").directive("scStatusBar",t)}(),function(){var e=function(e){return{restrict:"EA",replace:!0,templateUrl:"templates/scTalkCard.html",scope:{model:"="},controller:["$scope",function(e){e.placeholder={bg:"/images/talk/cover_placeholder.png"},e.cardBannerOverlayStyle={},e.$watch("model",function(t){if(t){var n=t,i=n.relationships.speaker.attributes.tags;i.length>4?e.speakerTags=i.slice(0,4):e.speakerTags=i;var a=n.attributes.getCoverImgUrls;a=a?a.medium:e.placeholder.bg,e.cardBannerStyle={"background-image":"url("+a+")"}}})}],link:function(t,n){var i=$(n[0]),a=i.find(".talk-name");i.find(".card-banner");e(function(){var e=a.height(),n=144,i=36,s=32.5,r=n-e-i-s+3;if(24>r){var o=(r+24)/2-3;t.cardBannerOverlayStyle["padding-top"]=o+"px"}},0)}}};e.$inject=["$timeout"],angular.module("AiliBot").directive("scTalkCard",e)}();var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();!function(){var e=function(e){var t=function(){function t(e,n){_classCallCheck(this,t),this.slides=e,this.options=n,this.currPlayTime=0,this.currSlideIndex=-1,this.syncTimer=null}return _createClass(t,[{key:"play",value:function(){var t=this,n=arguments.length<=0||void 0===arguments[0]?0:arguments[0];this.setCurrPlayTime(n);var i=this.slides[this.currSlideIndex+1];i?!function(){var a=i.timestamp-n;t.syncTimer=e(function(){t.currPlayTime+=a,t.currSlideIndex+=1,t.options.onPlay(t),t.play(t.currPlayTime)},a)}():(console.log("All slides are played"),this.stop())}},{key:"pause",value:function(t){this.setCurrPlayTime(t),this.syncTimer&&(e.cancel(this.syncTimer),this.syncTimer=null,console.log("cancel timer"))}},{key:"resume",value:function(e){this.play(e)}},{key:"stop",value:function(){this.pause(0)}},{key:"getCurrSlide",value:function(){return this.slides[this.currSlideIndex]?this.slides[this.currSlideIndex].content:null}},{key:"resetCurrSlideIndex",value:function(){if(this.slides.length)if(this.currSlideIndex=-1,_.last(this.slides).timestamp<=this.currPlayTime)this.currSlideIndex=this.slides.length-1;else for(var e=1;this.slides[e];e++)if(this.slides[e].timestamp>this.currPlayTime&&this.slides[e-1].timestamp<=this.currPlayTime){this.currSlideIndex=e-1;break}}},{key:"setCurrPlayTime",value:function(e){this.currPlayTime=e,this.resetCurrSlideIndex()}}]),t}();return t};e.$inject=["$timeout"];var t=function(e,t,n,i,a){return{restrict:"EA",replace:!0,scope:{slides:"=",talk:"="},templateUrl:"templates/scTalkPlayer.html",controller:["$scope",function(e){e.trustedAudioSrc=function(e){return n.trustAsResourceUrl(e)},e.isMobile=t.isMobile(),e.waiting=!e.isMobile}],link:function(t,n){var s=a.getCurrentUser(),r=s&&s.attributes?s.attributes.nickname:"",o=void 0,l=void 0;o=new e(t.slides,{onPlay:function(e){t.currentSlide=e.getCurrSlide()}}),t.$on("$destroy",function(){o.syncTimer&&i.cancel(o.syncTimer)}),setTimeout(function(){l=new MediaElementPlayer("#player",{audioWidth:t.isMobile?$(window).width():600,audioHeight:40,features:["playpause","progress","current","duration"],alwaysShowHours:!0,success:function(e){function n(){console.log("currentTime: "+e.currentTime),console.log("slidesList currPlayTime: "+parseInt(o.currPlayTime/1e3))}var i=void 0,a=void 0,l=void 0;e.addEventListener("playing",function(){console.log("playing"),t.$apply(function(){return t.waiting=!1}),o.currPlayTime?(o.resume(1e3*e.currentTime),n()):o.play(),a=Date.now(),ga("send","event","group_name:"+t.talk.attributes.name+", group_id:"+t.talk.id,"play_audio","user_nickname:"+r+", user_id:"+(s?s.id:"n/a"))}),e.addEventListener("pause",function(){o.pause(1e3*e.currentTime),l=Date.now(),i=Math.round((l-a)/1e3),console.log("duration is "+i+" seconds."),ga("send","event","group_name:"+t.talk.attributes.name+", group_id:"+t.talk.id,"send_listen_duration","user_nickname:"+r+", user_id:"+(s?s.id:"n/a"),i)}),e.addEventListener("ended",function(){console.log("ended"),o.stop()}),e.addEventListener("seeked",function(){t.$apply(function(){o.pause(1e3*e.currentTime),t.waiting=!1,t.currentSlide=o.getCurrSlide(),n()})}),e.addEventListener("seeking",function(){o.pause(1e3*e.currentTime),t.$apply(function(){return t.waiting=!0}),console.log("seeking")}),e.addEventListener("canplay",function(){t.$apply(function(){return t.waiting=!1})})}})},500)}}};t.$inject=["scTalkPlayerSlidesList","Util","$sce","$timeout","Auth"],angular.module("AiliBot").factory("scTalkPlayerSlidesList",e),angular.module("AiliBot").directive("scTalkPlayer",t)}(),function(){function e(e,t){return new Dropzone("#slides-dropzone",{headers:t.defaultHeaders,url:t.url,paramName:function(){return"attachments"},acceptedFiles:"image/*",accept:function(t,n){return e.attributes.SpeakerId?void n():n("请先设置主讲人。")},previewTemplate:$("#img-uploading-spinner").html(),uploadMultiple:!0,parallelUploads:20,init:function(){this.on("addedfile",function(e){}),this.on("sendingmultiple",function(t,n,i){t.forEach(function(t,n){i.append("data["+n+"][attributes][UserId]",e.attributes.SpeakerId),i.append("data["+n+"][attributes][order]",e.slides.length+n)})}),this.on("successmultiple",function(n,i){i.data.forEach(function(t){var n={id:t.id};_.extend(n,t.attributes),e.slides=e.slides||[],e.slides.push(n)}),e.slides&&(e.slides=_.sortBy(e.slides,"order")),$(".dz-preview").remove(),t.onSuccess()})}})}function t(e,t,n){return new Promise(function(i,a){n.child("threads/"+t+"/"+e).remove(function(t){return t?a(t):void n.child("replies/"+e).remove(function(t){return t?a(t):void i(e)})})})}var n=function(n,i,a,s,r,o,l,c,d,u,p,m,h,g){function v(e,t){t=t||"success",a.create({message:e,type:t})}return{restrict:"EA",templateUrl:"templates/scTalkEditor.html",replace:!0,scope:{hasSlides:"@",hasQuestions:"@",hasTalkClips:"@",afterSave:"&",mode:"@"},controller:["$scope","$element","uiGridConstants",function(e,t,n){function a(t){return t=t||c.restangularizeElement(null,{},"groups"),t.attributes={status:2,talkType:3,priority:-1,SpeakerId:e.talk.attributes.SpeakerId,ParentTalkId:e.talk.id},e.talk.talkClips&&(t.attributes.clipOrder=e.talk.talkClips.length),t}function s(e){e.formattedTalkStartedAt=function(){return l.formattedDuration(parseInt(this.attributes.talkStartedAt/1e3))}.bind(e),e.formattedTalkLength=function(){return l.formattedDuration(this.attributes.talkLength)}.bind(e)}e.processing=!1,e.mode=+e.mode||0,e.audioUploading={processing:!1,percentage:"0%"},e.coverImgUploading={processing:!1,percentage:"0%"},e.thumbnailUploading={processing:!1,percentage:"0%"},e.talkMaterialUploading={processing:!1,percentage:"0%"},e.has={slides:"true"===e.hasSlides,questions:"true"===e.hasQuestions,talkClips:"true"===e.hasTalkClips},e.talk=i(t.attr("ng-model"))(e.$parent),e.previousStatus=e.talk.attributes.status,e.isEntireTalk=0===e.talk.attributes.talkType||5===e.talk.attributes.talkType,e.talk.slides&&(e.talk.slides=_.sortBy(e.talk.slides,"order")),e.sortableOptions={containment:"parent",cursor:"move",opacity:.5,tolerance:"pointer"},e.talkTypeOptions=[{value:0,label:"普通"},{value:5,label:"工具"},{value:1,label:"片段"},{value:2,label:"摘要"},{value:3,label:"摘要片段"},{value:4,label:"测试"}],e.priorityOptions=[{value:-50,label:"深度隐藏（搜索不到）"},{value:-1,label:"隐藏（可搜索到）"},{value:0,label:"显示"}],e.statusOptions=[{value:0,label:"未开始"},{value:1,label:"进行中"},{value:2,label:"结束"}],e.permissionOptions=[{value:0,label:"不需要"},{value:1,label:"需要邀请码或分享"},{value:2,label:"需要邀请码"}],e.isEntireTalk&&(e.clipsGridOptions={data:"data",columnDefs:[{field:"attributes.description",displayName:"标题",cellTemplate:'<div class="ui-grid-cell-contents"><a ui-sref="admin.talk({talkId:row.entity.id})">{{MODEL_COL_FIELD}}</a></div>',
width:"55%"},{field:"attributes.formattedTalkLength",displayName:"时长",width:"15%"},{field:"attributes.formattedTalkStartedAt",displayName:"开始于",width:"15%"},{field:"attributes.clipOrder",displayName:"片段顺序",sort:{direction:n.ASC},width:"15%",type:"number"}]},e.data=[],p(function(){_.each(e.talk.talkClips,function(e){e.attributes.formattedTalkLength=l.formattedDuration(e.attributes.talkLength),e.attributes.formattedTalkStartedAt=l.formattedDuration(parseInt(e.attributes.talkStartedAt/1e3))}),e.data=e.talk.talkClips},5e3),e.newTalk=a(),e.afterCreateTalk=function(t){v("创建成功。"),e.showNewTalkModal=!1;var n={id:t.id};_.extend(n,e.newTalk.attributes),s(n),e.clipsGridOptions.data.push(n),a(e.newTalk)}),e.onInvalidTag=function(e){v('不能包含特殊字符: ".", "#", "$", "/", "[", or "]"')}}],link:function(i,a,f){function b(){$("#new-talk-modal-content").find(".scroll").append(n('<sc-talk-editor ng-model="newTalk" after-save="afterCreateTalk(res)">')(i)[0])}function k(e){function t(t){var n=e.getKey?e.getKey(t):e.key,a=e.getOssUploadOptions?e.getOssUploadOptions(t,e):E.getOssUploadOptions({name:e.name,file:t,key:n,scope:i,alertContainer:".admin-page"});i.$apply(function(){i[e.name+"Uploading"].processing=!0}),h.init().then(function(e){e.upload(a)},function(e){console.log(e),v("Oops!出错了!","error")})}return new Dropzone(e.elementId,{url:"nourl",autoProcessQueue:!1,acceptedFiles:e.acceptedFiles,previewTemplate:$("#img-uploading-spinner").html(),init:function(){this.on("addedfile",t)}})}var y,w={"x-smartchat-key":"6f1ba4f85ee571b004ccfcf21329d6e197807cf556"},A=c.all("users"),E=(c.all("groups"),new u(i.talk.id));i.isEntireTalk&&p(function(){b()},400),i.scTalk=E,i.tagsSource=function(e){return d(function(t){var n=_.filter(["申请方法论","英语考试","背景提升","励志心理","专业揭秘","申请经验","职业发展"],function(t){return t.match(e)});t(n)})},i.save=function(){i.processing||i.talkEditorForm.$invalid||(i.processing=!0,i.talk.questions&&i.talk.questions.forEach(function(e){""===e.attributes.content&&t(e.id,i.talk.id,r)}),i.talk.slides&&i.talk.slides.forEach(function(e,t){e.order=t}),0!==i.mode&&(i.talk.attributes=_.omit(i.talk.attributes,["status","talkType"])),i.talk.save().then(function(e){v("保存成功。"),i.processing=!1,5===i.talk.attributes.talkType&&1===i.previousStatus&&2===i.talk.attributes.status&&(i.talk.attributes.priority=-50),i.previousStatus=i.talk.attributes.status,e.questions&&(i.talk.questions=e.questions),i.afterSave&&i.afterSave({res:e}),0!==i.mode&&(i.talk.attributes.status=e.attributes.status)},function(e){console.log(e),i.processing=!1,v("哎呀，出错啦。","error")}))},i.newQuestion=function(){i.talk.questions=i.talk.questions||[],i.talk.questions.push({attributes:{content:"",replies:[{content:""}]}})},i.deleteQuestion=function(e){var n=e.id;i.talk.questions=_.reject(i.talk.questions,function(t){return e===t}),n&&t(n,i.talk.id,r).then(function(){v("删除成功。")},function(e){v("哎呀，出错啦。","error")})},i.deleteSlide=function(e){var t=e.id,n={"fields[group]":"slidesSequence",include:"slides","fields[slide]":"UserId,GroupId,ThreadId,id,order,description"};return i.talk.slides=_.reject(i.talk.slides,function(t){return t===e}),c.one("slides",t).remove().then(function(){return v("删除成功。"),E.get(n)}).then(function(e){i.talk.attributes.slidesSequence=e.attributes.slidesSequence,E.setSlidesShownAt(i.talk)},function(e){console.log(e),v("哎呀，出错啦。","error")})},i.showUserEditorModal=function(){i.newUser={attributes:{wxUnionid:l.genRandomStr(),accountRole:3}};var e,t=n('<sc-user-editor ng-model="newUser" on-save="saveUser"></sc-user-editor>')(i);t=angular.element("<div>").append(t).html(),e='<ion-modal-view class="admin user-editor-modal"><button type="button" class="close" ng-click="userEditorModal.remove()">x</button><ion-header-bar><h1 class="title">编辑用户</h1></ion-header-bar><ion-content overflow-scroll="true" class="container">'+t+"</ion-content></ion-modal-view>",i.userEditorModal=o.fromTemplate(e,{backdropClickToClose:!1,scope:i}),i.userEditorModal.show()},i.saveUser=function(){return A.login({data:i.newUser.attributes}).then(function(){i.userEditorModal.remove(),v("保存成功。")},function(e){return e})},i.showingNewTalkModal=function(){i.showNewTalkModal=!0},i.fetchUsers=function(e){var t={"filter[nickname]":e,"filter[accountRole]":"1,2,3","fields[user]":"id,nickname","page[size]":20};return A.getList(t).then(function(e){return e.map(function(e){return{label:e.attributes.nickname,value:e.id}})})},i.talk.speaker?i.userExternalModel={value:i.talk.speaker.id,label:i.talk.speaker.nickname}:i.userExternalModel={},i.userModelToItemMethod=function(e){return e},i.has.slides&&(y=s.getURL("v2")+"/groups/"+i.talk.id+"/slides",p(function(){m.getCurrentUser()?(w.Authorization="Bearer "+m.getCurrentUser().accessToken,e(i.talk,{url:y,onSuccess:function(){i.$apply(),v("图片上传成功。")},defaultHeaders:w})):g.getById(i.talk.attributes.SpeakerId).then(function(e){var t=e.attributes.wxUnionid;return g.login({data:{wxUnionid:t}})}).then(function(t){w.Authorization="Bearer "+t.accessToken,e(i.talk,{url:y,onSuccess:function(){i.$apply(),v("图片上传成功。")},defaultHeaders:w})}),k({elementId:"#audio-dropzone",name:"audio",key:"talks/talk_"+i.talk.id+"/recordings.mp3",acceptedFiles:"audio/*"}),k({elementId:"#cover-img-dropzone",name:"coverImg",key:"talks/talk_"+i.talk.id+"/cover_img_"+ +new Date+".jpg",acceptedFiles:"image/*"}),k({elementId:"#thumbnail-dropzone",name:"thumbnail",key:"talks/talk_"+i.talk.id+"/thumbnail_"+ +new Date+".jpg",acceptedFiles:"image/*"}),k({elementId:"#talk-material-dropzone",name:"talkMaterial",getKey:function(e){var t=e.name.trim().replace(/\s/g,"_");return"talk_materials/talk_"+i.talk.id+"/"+t},acceptedFiles:"",getOssUploadOptions:function(e,t){var n=e.name.trim().replace(/\s/g,"_"),a="talk_materials/talk_"+i.talk.id+"/"+n,s=t.name+"Uploading";return{key:a,file:e,maxRetry:3,onerror:function(){v("Oops!上传失败。请稍后再试一次。","error"),i.$apply(function(){i[s].processing=!1,i[s].percentage="0%"})},onprogress:function(e){i.$apply(function(){i[s].percentage=Math.ceil(100*e.loaded/e.total)+"%"})},oncomplete:function(){$(".dz-preview").remove(),E.saveTalkMaterial({attachmentSrc:h.url+"/"+a,attachmentContentType:e.type,attachmentFileName:e.name,attachmentFileSize:e.size}).then(function(e){i.talk.talkMaterials=i.talk.talkMaterials||[],i.talk.talkMaterials.push(_.extend({id:e.id},e.attributes))}),v("上传成功。"),i.$apply(function(){i[s].processing=!1,i[s].percentage="0%"})}}}})},500))}}};n.$inject=["$compile","$parse","ywAlert","API_ENDPOINT","FirebaseRef","$ionicModal","Util","Restangular","$q","SCGroup","$timeout","Auth","OssUploadService","Users"];var i=function(e){return{restrict:"EA",replace:!0,scope:{},templateUrl:"templates/scQuestionEditor.html",link:function(t,n,i){t.question=e(i.ngModel)(t.$parent)}}};i.$inject=["$parse"];var a=function(e){return{restrict:"EA",replace:!0,scope:{mode:"@",order:"="},templateUrl:"templates/scSlideEditor.html",controller:["$scope",function(e){e._mode=+e.mode||0}],link:function(t,n,i){t.slide=e(i.ngModel)(t.$parent)}}};a.$inject=["$parse"];var s=function(e,t){return{restrict:"EA",replace:!0,scope:{scTalk:"="},templateUrl:"templates/scTalkMaterialEditor.html",link:function(n,i,a){n.model=e(a.ngModel)(n.$parent),n.state=0,n.save=function(e){e.preventDefault(),n.state=0,n.scTalk.saveTalkMaterial({attachmentFileName:n.model.attachmentFileName},n.model.id).then(function(){t.create({message:"保存成功"},{container:".admin-page"})},function(e){t.create({message:"保存失败",type:"error"},{container:".admin-page"})})},n.cancel=function(e){e.preventDefault(),n.state=0}}}};s.$inject=["$parse","ywAlert"];var r=function(){return{restrict:"EA",require:"^ngModel",link:function(e,t,n,i){i.$formatters.unshift(function(e){return e?e.split("|").map(function(e){return Math.round(+e/1e3)}).join("|"):e}),i.$parsers.unshift(function(e){return e?e.split("|").map(function(e){return 1e3*+e}).join("|"):e})}}};angular.module("AiliBot").directive("scTalkEditor",n),angular.module("AiliBot").directive("scQuestionEditor",i),angular.module("AiliBot").directive("scSlideEditor",a),angular.module("AiliBot").directive("scTalkMaterialEditor",s),angular.module("AiliBot").directive("secToMillisec",r)}(),function(){var e=function(e){return{restrict:"EA",replace:!0,templateUrl:"templates/scTalkPreview.html",scope:{model:"="},controller:["$scope","uiGridConstants",function(t,n){t.clipsGridOptions={data:[],columnDefs:[{name:"name",displayName:"标题",cellTemplate:'<div class="ui-grid-cell-contents"><a ui-sref="admin.talk({talkId:row.entity.id})">{{MODEL_COL_FIELD}}</a></div>',width:"55%"},{field:"formattedTalkLength()",displayName:"时长",width:"15%"},{field:"formattedTalkStartedAt()",displayName:"开始于",width:"15%"},{name:"clipOrder",displayName:"片段顺序",sort:{direction:n.ASC},width:"15%"}]},t.$watchCollection("model.talkClips",function(n,i){n&&(n.forEach(function(t){t.formattedTalkStartedAt=function(){return e.formattedDuration(parseInt(this.talkStartedAt/1e3))}.bind(t),t.formattedTalkLength=function(){return e.formattedDuration(this.talkLength)}.bind(t)}),t.clipsGridOptions.data=n)}),t.formattedDuration=e.formattedDuration,t.isShown=function(e){return-1!==e&&-100!==e};var i=0;t.formattedSlidesShownAt=function(t){return t?(i++,console.log(i),t.split("|").map(function(t){return e.formattedDuration(+t/1e3)}).join("|")):t}}]}};e.$inject=["Util"],angular.module("AiliBot").directive("scTalkPreview",e)}(),function(){var e=function(e,t){var n=t.currentUser&&t.currentUser.id,i=!1,a=1e3;e.toggleLikeThread=function(t){n&&e.groupId&&(i||(i=!0,t.isLiked?t.unlike(n,e.groupId):t.like(n,e.groupId),setTimeout(function(){i=!1},a)))}};e.$inject=["$scope","Auth"];var t=function(){return{restrict:"EA",templateUrl:"templates/scThreadRow.html",replace:!0,scope:{model:"=",groupId:"@",topicClip:"@"},controller:e,link:function(e){e.topicClip="true"===e.topicClip}}};angular.module("AiliBot").directive("scThreadRow",t)}(),function(){var e=function(e){return{restrict:"EA",replace:!0,templateUrl:"templates/scTalkSeries.html",scope:{model:"="}}};e.$inject=["$timeout"],angular.module("AiliBot").directive("scTalkSeries",e)}(),function(){var e=function(e,t,n,i,a){return{restrict:"EA",templateUrl:"templates/scUserEditor.html",replace:!0,scope:{onSave:"&"},link:function(s,r,o){function l(e){function n(e){s.$apply(function(){s[c].processing=!1,s[c].percentage="0%"})}function r(){$(".dz-preview").remove(),s.user.attributes[e.name]=a.url+"/"+e.key,i.create({message:"上传成功。"}),s.$apply(function(){s[c].processing=!1,s[c].percentage="0%",s.user.save()})}function o(e){s.$apply(function(){s[c].percentage=Math.ceil(100*e.loaded/e.total)+"%"})}function l(t){var l={key:e.key,file:t,onerror:n,onprogress:o,oncomplete:r};s.$apply(function(){s[e.name+"Uploading"].processing=!0}),a.init().then(function(e){e.upload(l)},function(e){console.log(e),i({message:"Oops!出错了!",type:"error"})})}var c=e.name+"Uploading";return new Dropzone(e.elementId,{url:"nourl",autoProcessQueue:!1,acceptedFiles:e.acceptedFiles,previewTemplate:t('<div><div class="dz-preview loader"><div>正在上传</div><ion-spinner></ion-spinner></div></div>')(s).html(),init:function(){this.on("addedfile",l)}})}s.user=e(o.ngModel)(s.$parent),s.headimgurlUploading={percentage:"0%",processing:!1},s.save=function(){return s.processing?void 0:(s.processing=!0,s.onSave()().then(function(){s.processing=!1},function(){s.processing=!1}))},n(function(){l({elementId:"#headimg-dropzone",name:"headimgurl",key:"users/user_"+s.user.id+"/headimg_"+ +new Date+".jpg",acceptedFiles:"image/*"})},500)}}};e.$inject=["$parse","$compile","$timeout","ywAlert","OssUploadService"],angular.module("AiliBot").directive("scUserEditor",e)}(),function(){var e=function(e,t){e.$watch("model.objectId",function(n){n&&(e.thread=new t(e.groupId,n))})};e.$inject=["$scope","ThreadObject"];var t=function(){return{restrict:"EA",templateUrl:"templates/scWhiteboard.html",replace:!0,scope:{model:"=",groupId:"@"},controller:e}};angular.module("AiliBot").directive("scWhiteboard",t)}(),function(){var e=function(e,t,n,i,a){var s,r=t.all("users");e.user={},e.submit=function(){e.processing||(e.processing=!0,r.login({data:e.user,type:"code"}).then(function(t){e.processing=!1,i.setCurrentUser(t),s=i.getReturnTo(),e.afterSubmit({res:t}),s?a.go(s.state.name,s.params):a.go("admin.talks")},function(t){e.processing=!1,n.create({message:t.data.errors[0].message,type:"error"},{container:".admin-login-page"})}))}};e.$inject=["$scope","Restangular","ywAlert","Auth","$state"];var t=function(){return{restrict:"EA",replace:!0,scope:{afterSubmit:"&"},templateUrl:"templates/scLogin.html",controller:e}};angular.module("AiliBot").directive("scLogin",t)}(),function(){var e=function(){return{restrict:"EA",replace:!0,templateUrl:"templates/scRatingStars.html",scope:{rating:"=",size:"@"},controller:["$scope",function(e){e.roundToHalf=function(e){return Math.round(2*e)/2}}]}};angular.module("AiliBot").directive("scRatingStars",e)}(),angular.module("AiliBot").run(["$templateCache",function(e){e.put("templates/scRatingStars.html",'\n<div class="sc-rating-stars">\n  <div ng-if="size === \'12\'" class="size-12-container"><i ng-repeat="i in [0, 1, 2, 3, 4]" ng-class="{\'icon-emptystar\': roundToHalf(rating) &lt;= i, \'icon-halfstar\': roundToHalf(rating) === i + 0.5, \'icon-fullstar\': roundToHalf(rating) &gt;= i + 1}" class="sprite-icon"></i></div>\n  <div ng-if="size === \'10\'" class="size-10-container"><i ng-repeat="i in [0, 1, 2, 3, 4]" ng-class="{\'icon-emptystar_s\': roundToHalf(rating) &lt;= i, \'icon-halfstar_s\': roundToHalf(rating) === i + 0.5, \'icon-fullstar_s\': roundToHalf(rating) &gt;= i + 1}" class="sprite-icon"></i></div>\n</div>'),e.put("templates/chat.html",'\n<ion-view view-title="Aili" class="talk-view">\n  <ion-nav-title>Aili Bot</ion-nav-title>\n  <div class="ion-view-body">\n    <div class="content-container">\n      <ion-content id="messages-container" delegate-handle="messagesScroll" chat-input-id="#chat-input-view" on-scroll="onScroll()" on-scroll-complete="onScrollComplete()" class="has-footer">\n        <infinite-scroll-top on-infinite="fetchMoreMessages()" ng-if="!messages.allFetched"></infinite-scroll-top>\n        <!--.loader(ng-hide="messages")ion-spinner\n        -->\n        <div class="content">\n          <div style="visibility:hidden;height:1px;overflow:hidden">without me, messages won\'t render in Android wechat web view!</div>\n          <sc-message model="message" ng-repeat="message in messages.data"></sc-message>\n        </div>\n      </ion-content>\n    </div>\n  </div>\n  <ion-footer-bar id="chat-input-view" keyboard-attach="" class="bar-autoheight">\n    <sc-chat-input messages="messages" messages-container-id="#messages-container" ng-hide="isMuted"></sc-chat-input>\n  </ion-footer-bar>\n</ion-view>'),e.put("templates/main.html",'\n<ion-nav-bar align-title="center" no-tap-scroll="true" class="bar-positive">\n  <ion-nav-back-button></ion-nav-back-button>\n</ion-nav-bar>\n<ion-nav-view name="viewContent"></ion-nav-view>'),e.put("templates/scAppBanner.html",'\n<div ng-click="download()" class="sc-app-banner"><i class="sprite-icon icon-sclogo"></i>\n  <div class="app-name">小板凳</div>\n  <div class="app-info">用小板凳APP打开</div>\n  <div class="app-link">OPEN</div>\n</div>'),e.put("templates/scChatInput.html",'\n<div class="sc-chat-input-container clearfix mode-{{mode}}">\n  <div class="sc-chat-text-input-container">\n    <textarea id="chat-text-input" ng-model="message.attributes.content" name="chat-text-input" msd-elastic="\n" rows="1" placeholder="输入......" class="size-s"></textarea>\n  </div>\n  <div class="sc-chat-input-action-container">\n    <div on-tap="sendMessage($event)" ng-class="{disabled:!message.attributes.content.length||sendingMessage}" class="btn-send">\n      <div class="icon-send sprite-icon"></div>\n    </div>\n  </div>\n</div>'),e.put("templates/scFeaturedTalkEditor.html",'\n<div>\n  <p><a ui-sref="admin.talk({talkId: talk.id})">{{talk.attributes.name}}</a></p>\n  <p ng-hide="talk.attributes.bannerImgSrc">还没有上传banner图片</p><img ng-if="talk.attributes.bannerImgSrc" ng-src="{{talk.attributes.bannerImgSrc}}" height="100"/>\n  <div ng-show="bannerImgUploading.processing" class="progress">\n    <div style="width: {{bannerImgUploading.percentage}};" class="progress-bar">{{bannerImgUploading.percentage}}</div>\n  </div>\n  <div id="banner-img-dropzone-{{talk.id}}" class="dropzone"></div>\n</div>'),e.put("templates/scLogin.html",'\n<form name="loginForm" ng-submit="submit()" class="form-login">\n  <div class="bar bar-header">\n    <div class="title">Login</div>\n  </div>\n  <div class="has-header content">\n    <div class="list">\n      <label class="item item-input">\n        <input type="text" placeholder="code" ng-model="user.code" required=""/>\n      </label>\n    </div>\n    <div class="padding">\n      <button type="submit" ng-disabled="processing || loginForm.$invalid" class="button button-positive button-block">submit</button>\n    </div>\n  </div>\n</form>'),e.put("templates/scMessage.html",'\n<div ng-switch="model.attributes.type" id="message-{{model.id}}" class="sc-message-view">\n  <div ng-switch-default="ng-switch-default" class="user-msg">\n    <div ng-class="{mine:model.attributes.senderId === currentUser.id}" class="sc-message-container clearfix">\n      <div class="sc-message-left"><img ng-src="{{model.relationships.user.data.attributes.headimgurl}}" title="user photo" class="user-photo img-thumbnail"/></div>\n      <div class="sc-message-right size-s">\n        <div ng-switch="model.attributes.type">\n          <div ng-switch-when="0">{{model.attributes.content}}</div>\n          <div ng-switch-when="1" class="media-container">\n            <p><a href="{{trustedResourceUrl(model.relationships.media.data.attributes.link)}}">{{model.relationships.media.data.attributes.title}}</a></p>\n            <p>摘要: {{model.relationships.media.data.attributes.summary}}</p>\n            <div><span>{{model.relationships.media.data.attributes.source}} &nbsp;&nbsp;</span><span>{{model.relationships.media.data.attributes.meta}}</span></div>\n          </div>\n          <div ng-switch-when="2" class="media-container">\n            <p>{{model.relationships.media.data.attributes.title}}</p>\n            <audio ng-src="{{trustedResourceUrl(model.relationships.media.data.attributes.mediaSrc)}}" controls="true" style="width:100%"></audio>\n            <p>摘要: {{model.relationships.media.data.attributes.summary}}</p>\n            <div><span>{{model.relationships.media.data.attributes.source}} &nbsp;&nbsp;</span><span>{{model.relationships.media.data.attributes.meta}}</span></div>\n          </div>\n          <div ng-switch-when="3" class="media-container">\n            <p>{{model.relationships.media.data.attributes.title}}</p>\n            <iframe ng-src="{{trustedResourceUrl(model.relationships.media.data.attributes.mediaSrc)}}" controls="true" allowfullscreen="true" frameborder="0" style="width:100%"></iframe>\n            <p>摘要: {{model.relationships.media.data.attributes.summary}}</p>\n            <div><span>{{model.relationships.media.data.attributes.source}} &nbsp;&nbsp;</span><span>{{model.relationships.media.data.attributes.meta}}</span></div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div ng-switch-when="6" class="system-msg text-gray size-xs"><span class="text">{{model.attributes.content}}</span></div>\n</div>'),e.put("templates/scVoice.html",'\n<div on-tap="togglePlay()" class="voice-message-placeholder"><i class="sprite-icon icon-voice_{{frameIndex}}"></i><span ng-show="loaded &amp;&amp; voiceLength !== \'0:01\'" class="size-s text-gray">{{voiceLength}}</span>\n  <ion-spinner ng-hide="loaded" class="ion-spinner"></ion-spinner>\n</div>\n<div ng-hide="model.isHeard" class="red-dot"></div>\n<audio controls="" ng-src="{{voiceData}}" data-tap-disabled="true"></audio>'),e.put("templates/scNotification.html",'\n<div ng-click="gotoEditMode()" ng-class="mode === 1 ? \'edit\' : \'read\'" class="sc-notification"><a title="编辑" class="edit-button"><i class="ion-compose"></i></a>\n  <div ng-show="mode === 0"><span>{{model.attributes.content}}</span><span class="item-note">推送时间(本地): {{model.attributes.scheduledAt | date: \'MM/dd h:mm a\'}}</span></div>\n  <form ng-show="mode === 1" novalidate="novalidate"><span>{{model.attributes.content}}</span><span class="item-note"><span>推送时间:</span>\n      <input type="datetime-local" name="notifiaction[scheduled_at]" ng-model="model.attributes.scheduledAt" class="inline-block"/></span>\n    <div class="button-bar"><a ng-click="update($event)" class="button">保存</a><a ng-click="gotoReadMode($event)" class="button">取消</a></div>\n  </form>\n</div>'),e.put("templates/scReviewNew.html",'\n<ion-modal-view class="sc-review-modal sc-review-new">\n  <form name="form" novalidate="">\n    <ion-header-bar class="bar-light">\n      <div class="buttons"><a on-tap="modalDelegate.hide()" class="size-s">取消</a></div>\n      <h1 class="title">请为讲座留下评价</h1>\n      <div class="buttons"><a on-tap="submit()" class="size-s">完成</a></div>\n    </ion-header-bar>\n    <ion-content class="text-gray size-s">\n      <div class="rating">\n        <div ng-show="form.$submitted">\n          <div ng-if="form.rating.$error.required" class="error">请点击星星给讲座打一个分吧</div>\n        </div>\n        <input type="number" ng-model="review.rating" name="rating" required=""/>\n        <div class="stars">\n          <icon ng-repeat="star in stars" ng-class="{solid:star.solid}" on-tap="toggleStar(star, $index)" class="size-m star ion-ios-star"></icon>\n        </div>\n        <div class="size-xs">请点击星星来打分</div>\n      </div>\n      <div class="comment">\n        <div ng-show="form.$submitted">\n          <div ng-if="form.content.$error.required" class="error">请用文字给讲座评价一下吧</div>\n        </div>\n        <textarea placeholder="请简单评价此次讲座" name="content" rows="10" ng-model="review.content" required="" class="size-s"></textarea>\n      </div>\n    </ion-content>\n  </form>\n</ion-modal-view>'),e.put("templates/scStatusBar.html",'\n<div class="sc-status-bar">\n  <div class="size-s">{{group.getStatusMessage(now)}}</div>\n</div>'),e.put("templates/scTalkCard.html",'\n<div ui-sref="app.talkPlayback({talkId: \'{{model.id}}\'})" class="sc-talk-card card-shadow">\n  <div ng-style="cardBannerStyle" class="card-banner">\n    <div ng-style="cardBannerOverlayStyle" class="card-banner-overlay">\n      <div class="talk-name"> \n        <div class="name-bar"></div>\n        <div class="two-lines">{{model.attributes.name || "讲座标题"}}</div>\n      </div><img src="{{model.relationships.speaker.attributes.headimgurl}}" alt="Talk Host Photo" class="speaker-photo"/>\n      <div class="speaker-name text-speaker">{{model.relationships.speaker.attributes.nickname || "主讲人昵称"}}</div>\n      <div class="speaker-tags text-speaker"><span ng-repeat="tag in model.relationships.speaker.attributes.tags"><span>{{tag}}</span><span ng-if="!$last">，</span></span></div>\n    </div>\n  </div>\n  <div class="card-footer">\n    <div ng-if="model.attributes.status === 0" class="status-container"><i class="sprite-icon icon-clock"></i><span>{{model.attributes.talkScheduledAt || \'TBD\' | date : \'yy/MM/dd h:mm a\'}}</span></div>\n    <div ng-if="model.attributes.status === 1" class="status-container"><i class="sprite-icon icon-live"></i><span>进行中</span></div>\n    <div ng-if="model.attributes.status === 2" class="status-container status-review">\n      <sc-rating-stars rating="model.attributes.rating" size="12"></sc-rating-stars><span>{{model.attributes.rating | number:1}} ({{model.attributes.reviewsCount}})</span>\n    </div>\n    <div class="views-container"><i class="sprite-icon icon-eye"></i><span>{{model.attributes.viewsCount || 0}}</span></div>\n  </div>\n</div>'),e.put("templates/scQuestionEditor.html",'\n<div class="sc-question-editor">\n  <div class="form-control">\n    <label>问题</label>\n    <textarea rows="2" ng-model="question.attributes.content" class="block"></textarea>\n  </div>\n  <div class="form-control">\n    <label>回答</label>\n    <textarea row="2" ng-model="question.attributes.replies[0].content" class="block"></textarea>\n  </div>\n</div>'),e.put("templates/scSlideEditor.html",'\n<div ng-form="slideForm" class="sc-slide-editor"><img ng-src="{{slide.getAttachmentUrls.medium}}" height="100"/>\n  <div class="form-control">\n    <label>PPT简介</label>\n    <textarea rows="2" ng-model="slide.description" name="slide_description" required="" class="block"></textarea>\n    <div ng-if="slideForm.slide_description.$error.required" class="warning">请填写简介并确保为相应PPT的主要内容（简介会成为播放列表中的片段标题，长度最好控制在8个中文字符以内）</div>\n  </div>\n  <div class="form-control">\n    <label>PPT编号: {{order}}</label>\n  </div>\n  <div ng-show="_mode === 0" class="form-control">\n    <label>PPT出现时间(秒数。若出现多次，用‘|’隔开，如\'90|200\')</label>\n    <input type="text" ng-model="slide._shownAt" name="slide_shown_at" sec-to-millisec=""/>\n  </div>\n</div>'),e.put("templates/scTalkEditor.html",'\n<div class="sc-talk-editor">\n  <form name="talkEditorForm" ng-submit="save()" novalidate="true">\n    <div class="row">\n      <div class="col col-67 form-left form-col">\n        <div class="col-inner card">\n          <div class="basics">\n            <h3 class="positive">基本信息</h3>\n            <div class="form-control">\n              <label>讲座标题</label>\n              <input type="text" name="name" ng-model="talk.attributes.name" required="" class="row"/>\n            </div>\n            <div class="form-control">\n              <label>讲座简介</label>\n              <textarea rows="3" name="description" ng-model="talk.attributes.description" class="block"></textarea>\n            </div>\n            <div class="form-control">\n              <label>讲座类别（请在以下7个类别中选择至少1个类别，请不要选择与讲座不相关的类别。“申请方法论”，“英语考试”，“背景提升”，“励志心理”，“专业揭秘”，“申请经验”，“职业发展”）</label>\n              <tags-input ng-model="talk.attributes.categories" add-from-autocomplete-only="true">\n                <auto-complete source="tagsSource($query)" debounce-delay="500" min-length="1"></auto-complete>\n              </tags-input>\n            </div>\n            <div ng-if="mode === 0" class="form-control">\n              <label>Subcategories</label>\n              <tags-input ng-model="talk.attributes.subCategories" min-length="1" allowed-tags-pattern="^[^\\.#\\$\\[\\]\\/]*$" on-invalid-tag="onInvalidTag()"></tags-input>\n            </div>\n            <div ng-if="mode === 0" class="form-control">\n              <label>讲座系列名称（最多一个）</label>\n              <input type="text" name="seriesName" ng-model="talk.attributes.seriesName" placeholder="GRE单词7天训练营" size="30"/>\n            </div>\n            <div ng-if="mode === 0" class="form-control">\n              <label>Tags</label>\n              <tags-input ng-model="talk.attributes.tags" min-length="1" required="" allowed-tags-pattern="^[^\\.#\\$\\[\\]\\/]*$" on-invalid-tag="onInvalidTag()"></tags-input>\n            </div>\n            <div class="form-control">\n              <label>Speaker Tags</label>\n              <tags-input ng-model="talk.attributes.speakerTags" min-length="1" required="" allowed-tags-pattern="^[^\\.#\\$\\[\\]\\/]*$" on-invalid-tag="onInvalidTag()"></tags-input>\n            </div>\n            <div ng-if="talk.attributes.talkType === 3">\n              <div class="form-control">\n                <label>片段顺序(从0开始)</label>\n                <input type="number" name="talk_clip_order" ng-model="talk.attributes.clipOrder" min="0" step="1"/>\n              </div>\n              <div class="form-control">\n                <label>开始于(在母讲座的时间轴上)，毫秒</label>\n                <input type="number" name="talk_started_at" ng-model="talk.attributes.talkStartedAt" min="0" step="1000"/>\n              </div>\n            </div>\n            <div ng-if="isEntireTalk">\n              <div>\n                <div class="form-control">\n                  <label>主讲人</label>\n                  <input type="text" name="talk_speaker_id" ng-model="talk.attributes.SpeakerId" ng-model-options="{updateOn: \'default blur\', debounce: {default: 1000, blur: 0}}" ion-autocomplete="" readonly="readonly" autocomplete="off" max-selected-items="1" items-method="fetchUsers(query)" item-value-key="value" item-view-value-key="label" external-model="userExternalModel" model-to-item-method="userModelToItemMethod(modelValue)" ng-disabled="mode !== 0" class="ion-autocomplete"/><a href="" ng-click="showUserEditorModal()" ng-show="mode === 0">添加用户</a>\n                </div>\n                <div ng-show="mode === 0" class="form-control">\n                  <label>评分</label>\n                  <input type="number" name="rating" ng-model="talk.attributes.rating" min="0" step="0.5" max="5"/>\n                </div>\n                <div ng-show="mode === 0" class="form-control">\n                  <label>评分数量</label>\n                  <input type="number" name="reviews_count" ng-model="talk.attributes.reviewsCount" min="0" step="1"/>\n                </div>\n                <div ng-show="mode === 0" class="form-control">\n                  <label>浏览数量</label>\n                  <input type="number" name="views_count" ng-model="talk.attributes.viewsCount" min="0" step="1"/>\n                </div>\n              </div>\n              <div class="form-control">\n                <label>进入讲座权限</label>\n                <select ng-model="talk.attributes.permission" ng-options="option.value as option.label for option in permissionOptions"></select>\n              </div>\n              <div class="form-control">\n                <label>设置密码</label>\n                <input type="text" name="code" ng-model="talk.attributes.code" pattern="[0-9]{6,6}"/>\n              </div>\n              <div class="form-control">\n                <label>分享预填内容</label>\n                <textarea name="share_content" ng-model="talk.attributes.shareInfo.content" rows="2" class="block"></textarea>\n              </div>\n              <div class="form-control">\n                <label>讲座开始前分享到微信的链接</label>\n                <textarea rows="1" name="share_link" ng-model="talk.attributes.shareInfo.link" placeholder="http://www.palmdrive.cn" class="block"></textarea>\n              </div>\n              <div class="form-control">\n                <label>讲座状态</label>\n                <select ng-model="talk.attributes.status" ng-options="status.value as status.label for status in statusOptions" ng-disabled="mode !== 0"></select>\n              </div>\n              <div class="form-control">\n                <label>计划开讲时间</label>\n                <input type="datetime-local" name="scheduled_at" ng-model="talk.attributes.talkScheduledAt"/>\n              </div>\n              <div ng-show="mode === 0" class="form-control">\n                <label>讲座结束于</label>\n                <input type="datetime-local" name="ended_at" ng-model="talk.attributes.talkEndedAt"/>\n              </div>\n            </div>\n            <div class="form-control">\n              <label>时长(秒)</label>\n              <input type="number" name="length" ng-model="talk.attributes.talkLength" min="0" step="1" required=""/>\n            </div>\n            <div ng-show="mode === 0" class="form-control">\n              <label>讲座类型</label>\n              <select ng-model="talk.attributes.talkType" name="talk_type" ng-options="op.value as op.label for op in talkTypeOptions"></select>\n            </div>\n            <div ng-show="mode === 0" class="form-control">\n              <label>是否显示该讲座在‘发现’列表里</label>\n              <select ng-model="talk.attributes.priority" name="talk_priority" ng-options="op.value as op.label for op in priorityOptions"></select>\n            </div>\n            <div ng-show="mode === 0" class="form-control">\n              <div ng-if="has.slides" class="audio">\n                <p>上传录音文件</p>\n                <div ng-show="talk.attributes.audioSrc"><a ui-sref="app.talkPlayback({talkId: talk.id})" target="_blank"><span class="ion-document"></span><span>&nbsp;录音文件已上传</span></a></div>\n                <div ng-show="audioUploading.processing" class="progress">\n                  <div style="width: {{audioUploading.percentage}};" class="progress-bar">{{audioUploading.percentage}}</div>\n                </div>\n                <div id="audio-dropzone" class="dropzone"></div>\n              </div>\n            </div>\n            <div class="form-control">\n              <div ng-if="has.slides" class="cover-img">\n                <p>上传讲座配图</p>\n                <div ng-show="talk.attributes.coverImgSrc"><img ng-src="{{talk.attributes.coverImgSrc}}" height="50"/></div>\n                <div ng-show="coverImgUploading.processing" class="progress">\n                  <div style="width: {{coverImgUploading.percentage}};" class="progress-bar">{{coverImgUploading.percentage}}</div>\n                </div>\n                <div id="cover-img-dropzone" class="dropzone"></div>\n              </div>\n            </div>\n            <div class="form-control">\n              <div ng-if="has.slides" class="cover-img">\n                <p>上传微信分享照片（尺寸要求：120x120像素，大小10k左右）</p>\n                <div ng-show="talk.attributes.thumbnailSrc"><img ng-src="{{talk.attributes.thumbnailSrc}}" height="50"/></div>\n                <div ng-show="thumbnailUploading.processing" class="progress">\n                  <div style="width: {{thumbnailUploading.percentage}};" class="progress-bar">{{thumbnailUploading.percentage}}</div>\n                </div>\n                <div id="thumbnail-dropzone" class="dropzone"></div>\n              </div>\n            </div>\n            <div class="form-control">\n              <div ng-if="has.slides" class="materials-container">\n                <p>上传讲座相关资料（支持PDF，Word，Excel，JPEG，PNG，请不要上传其他格式的文件，慎重上传Excel文件）</p>\n                <ul>\n                  <li ng-repeat="material in talk.talkMaterials" class="material">\n                    <sc-talk-material-editor ng-model="material" sc-talk="scTalk"></sc-talk-material-editor>\n                  </li>\n                </ul>\n                <div ng-show="talkMaterialUploading.processing" class="progress">\n                  <div style="width: {{talkMaterialUploading.percentage}};" class="progress-bar">{{talkMaterialUploading.percentage}}</div>\n                </div>\n                <div id="talk-material-dropzone" class="dropzone"></div>\n              </div>\n            </div>\n          </div>\n          <div ng-if="isEntireTalk &amp;&amp; talk.id &amp;&amp; has.talkClips" class="clips">\n            <h3 class="positive">讲座片段</h3><a ng-click="showingNewTalkModal()" href="">添加讲座片段</a>\n            <div ui-grid="clipsGridOptions" class="grid"></div>\n          </div>\n          <div ng-show="has.questions">\n            <h3 class="positive">问答记录</h3>\n            <div>\n              <ion-spinner ng-if="!talk.questions"></ion-spinner>\n            </div>\n            <ul ng-if="talk.questions" class="list questions">\n              <li ng-repeat="question in talk.questions" class="question item item-plain">\n                <button type="button" ng-click="deleteQuestion(question)" title="删除" class="close">x</button>\n                <sc-question-editor ng-model="question"></sc-question-editor>\n              </li>\n            </ul>\n            <button type="button" ng-click="newQuestion()" class="button button-positive">添加问题</button>\n          </div>\n        </div>\n      </div>\n      <div ng-if="has.slides" class="col col-33 form-right form-col">\n        <div class="col-inner card">\n          <h3 class="positive">讲座幻灯片</h3>\n          <div>每次最多上传20张（只支持图片格式，不支持PDF）</div>\n          <ul ui-sortable="sortableOptions" ng-model="talk.slides" class="list slides">\n            <li ng-repeat="slide in talk.slides" class="item item-plain slide-container">\n              <button type="button" ng-click="deleteSlide(slide)" title="删除" class="close">x</button>\n              <sc-slide-editor ng-model="slide" mode="{{mode}}" order="$index"></sc-slide-editor>\n            </li>\n          </ul>\n          <div ng-show="talk.attributes.SpeakerId">\n            <div id="slides-dropzone" class="dropzone"></div>\n          </div>\n          <div ng-hide="talk.attributes.SpeakerId" class="energized">设置主讲人后才可上传PPT</div>\n        </div>\n      </div>\n    </div>\n    <div class="form-action">\n      <button type="submit" ng-disabled="processing || talkEditorForm.$invalid" class="button button-positive">保存</button>\n    </div>\n    <div id="img-uploading-spinner" style="display:none">\n      <div class="dz-preview loader">\n        <div>正在上传</div>\n        <ion-spinner></ion-spinner>\n      </div>\n    </div>\n  </form>\n  <div ng-show="showNewTalkModal" class="new-talk-modal overlay-modal">\n    <button type="button" ng-click="showNewTalkModal = false" class="close">x</button>\n    <div class="bar bar-header">\n      <div class="title">创建片段</div>\n    </div>\n    <ion-content id="new-talk-modal-content" overflow-scroll="true" class="has-header"></ion-content>\n  </div>\n</div>'),
e.put("templates/scTalkMaterialEditor.html",'\n<div class="sc-talk-material-editor">\n  <div class="form-control"><span ng-show="state===0"><i class="ion-document"></i><a href="{{model.attachmentSrc}}" class="file-name">{{model.attachmentFileName}}</a><a ng-click="state=1" class="link">edit</a></span>\n    <div ng-show="state===1" class="item item-input-inset">\n      <label class="item-input-wrapper">\n        <input type="text" ng-model="model.attachmentFileName" name="material_file_name"/>\n      </label>\n      <button ng-click="save($event)" class="button button-small button-positive">保存</button>\n      <button ng-click="cancel($event)" class="button button-small">取消</button>\n    </div>\n  </div>\n</div>'),e.put("templates/scTalkPlayer.html",'\n<div class="sc-talk-player">\n  <div sc-background-container="" data-ratio="0.75" class="slides-list">\n    <ion-spinner ng-show="waiting" class="spinner"></ion-spinner>\n    <div ng-show="currentSlide &amp;&amp; currentSlide === slide.content" ng-repeat="slide in slides" class="slide">\n      <div style="background-image: url({{slide.content.attributes.getAttachmentUrls.medium}})" ng-if="slide.content.attributes.getAttachmentUrls" class="img"></div>\n      <div ng-if="!slide.content.attributes.getAttachmentUrls" class="question">\n        <p class="text-gray">提问:</p>\n        <p>{{slide.content.attributes.topic}}</p>\n      </div>\n    </div>\n    <div ng-hide="currentSlide" class="default-slide gray">\n      <div class="title size-m">{{talk.attributes.name}}</div>\n      <div class="subtitle">{{talk.relationships.speaker.attributes.nickname}}</div>\n    </div>\n  </div>\n  <audio id="player" src="{{trustedAudioSrc(talk.attributes.audioSrc)}}"></audio>\n</div>'),e.put("templates/scTalkPreview.html",'\n<div class="sc-talk-preview">\n  <div class="row">\n    <div class="col col-67">\n      <div class="card padding">\n        <p>主题：{{model.attributes.name}}</p>\n        <pre>{{model.attributes.description}}</pre>\n        <p><span>categories:</span><span ng-repeat="category in model.attributes.categories" class="label">{{category.text}}</span></p>\n        <p><span>subcategories:</span><span ng-repeat="subCategory in model.attributes.subCategories" class="label">{{subCategory.text}}</span></p>\n        <p><span>tags:</span><span ng-repeat="tag in model.attributes.tags" class="label">{{tag.text}}</span></p>\n        <p><span>主讲人:</span><span>{{model.speaker.nickname}}</span></p>\n        <p><span>时长:</span><span>{{formattedDuration(model.attributes.talkLength)}}</span></p>\n        <p><span>是否显示在’发现‘列表:</span><span>{{isShown(model.attributes.priority)}}</span></p>\n        <p>讲座片段：</p>\n        <div ui-grid="clipsGridOptions" class="grid"></div><br/><br/>\n        <p>问题记录</p>\n        <ul class="list">\n          <li ng-repeat="question in model.questions" class="item item-plain">\n            <p>{{question.attributes.content}}</p>\n            <p>{{question.attributes.replies[0].content}}</p>\n          </li>\n        </ul>\n      </div>\n    </div>\n    <div class="col col-33">\n      <div class="card padding">\n        <ul class="list slides">\n          <li ng-repeat="slide in model.slides | orderBy:\'order\'" class="item item-plain">\n            <div style="background-image:url({{slide.getAttachmentUrls.medium}})" class="slide"></div>\n            <p>{{slide.description}}</p>\n            <p><span>出现的时间: <br></span><span>{{formattedSlidesShownAt(slide._shownAt)}}</span></p>\n          </li>\n        </ul>\n      </div>\n    </div>\n  </div>\n</div>'),e.put("templates/scTalkSeries.html",'\n<div class="sc-talk-series card-shadow">\n  <div class="series-name"><span>{{model.seriesName}} &nbsp;</span><span>({{model.talks.length}}个讲座）</span></div>\n  <div class="series-card-container">\n    <div class="series-card-container-inner">\n      <div ng-repeat="talk in model.talks" ui-sref="app.talkPlayback({talkId: \'{{talk.id}}\'})" class="series-card">\n        <div ng-style="{\'background-image\': \'url({{talk.attributes.getCoverImgUrls.medium || \'/images/talk/cover_placeholder.png\'}})\'}" class="cover"></div>\n        <div class="talk-name">\n          <div class="three-lines">{{talk.attributes.name}}</div>\n        </div>\n        <div class="views-container"><i class="sprite-icon icon-eye"></i><span>{{talk.attributes.viewsCount || 0}}</span></div>\n      </div>\n    </div>\n  </div>\n</div>'),e.put("templates/scThreadRow.html",'\n<div class="sc-thread-row">\n  <div class="sc-thread-left"><a ui-sref="app.talk.thread({talkId:groupId, threadId: model.$id})">\n      <div data-ng-bind="model.topic" data-ellipsis="" data-ellipsis-symbol="..." ng-if="topicClip" class="sc-thread-content size-s max-two-lines text-black"></div>\n      <div ng-bind-html="model.topic" ng-if="!topicClip" class="sc-thread-content size-s text-black"></div>\n      <div class="sc-thread-meta-container size-s clearfix text-gray">\n        <div class="meta"><img ng-src="{{model.author.headimgurl}}" class="img-xs img-circle"/><span>{{model.author.nickname}}</span></div>\n        <div class="meta">{{model.repliesCount || 0}}回复</div>\n        <!--a.meta(ui-sref="app.talk({talkId:groupId})")\n        i.sprite-icon.icon-comment\n        span 回复\n        \n        -->\n      </div></a></div>\n  <div on-tap="toggleLikeThread(model)" class="sc-thread-right">\n    <div class="sprite-icon icon-star_{{model.isLiked ? \'selected\' : \'normal\'}}"></div>\n    <div ng-class="{liked:model.isLiked}" class="likes-count">{{model.likesCount}}</div>\n  </div>\n</div>'),e.put("templates/scUserEditor.html",'\n<div class="sc-user-editor">\n  <form name="userEditorForm" ng-submit="save()">\n    <div class="form-control">\n      <label>name</label>\n      <input type="text" ng-model="user.attributes.nickname" name="user_name" required=""/>\n    </div>\n    <div class="form-control">\n      <label>intro</label>\n      <textarea rows="4" ng-model="user.attributes.intro" name="user_name" class="block"></textarea>\n    </div>\n    <div class="form-control">\n      <label>头像</label><img ng-src="{{user.attributes.headimgurl}}" ng-if="user.attributes.headimgurl" height="100"/>\n      <div ng-show="headimgurlUploading.processing" class="progress">\n        <div style="width: {{headimgurlUploading.percentage}};" class="progress-bar">{{headimgurlUploading.percentage}}</div>\n      </div>\n      <div id="headimg-dropzone" class="dropzone"></div>\n    </div>\n    <div class="form-action">\n      <button type="submit" ng-disabled="processing || userEditorForm.$invalid" class="button button-positive">保存</button>\n    </div>\n  </form>\n</div>'),e.put("templates/scWhiteboard.html",'\n<div class="sc-whiteboard">\n  <sc-thread-row model="thread" group-id="{{groupId}}" topic-clip="true"></sc-thread-row>\n</div>')}]);